<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="IELE Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../assets/img/favicon.ico" />

<title>IELE Semantics | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../index.html"> IELE Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/iele-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../">Homepage</a>
      <a class="bd-toc-link" href="../INSTALL">Install</a>
      <a class="bd-toc-link" href="../Design">Design</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="iele-execution">IELE Execution</h1>
<p>IELE is a register-based abstract machine over some simple opcodes.
Most of the opcodes are &quot;local&quot; to the execution state of the machine, but some of them must interact with the world state.
This file only defines the local execution operations. A separate <code>cardano.md</code> will eventually be created to describe the remainder
of the transaction protocol.</p>
<pre class="language-k"><code><span class="token keyword">requires</span> <span class="token string">&quot;data.md&quot;</span>
<span class="token keyword">requires</span> <span class="token string">&quot;iele-syntax.md&quot;</span>
<span class="token keyword">requires</span> <span class="token string">&quot;iele-gas.md&quot;</span>
<span class="token keyword">requires</span> <span class="token string">&quot;well-formedness.md&quot;</span>

<span class="token keyword">module</span> IELE<span class="token operator">-</span>CONFIGURATION
    <span class="token keyword">imports</span> STRING
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>DATA
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>COMMON
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>WELL<span class="token operator">-</span>FORMEDNESS
    <span class="token keyword">imports</span> DEFAULT<span class="token operator">-</span>CONFIGURATION
</code></pre>
<h2 id="configuration">Configuration</h2>
<p>We&apos;ve broken up the configuration into two components; those parts of the state that mutate during execution of a single transaction and those that are static throughout.
In the comments next to each cell, we explain the purpose of the cell.</p>
<pre class="language-k"><code>    <span class="token keyword">configuration</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">/&gt;</span></span>                                               <span class="token comment">// Current computation</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exit-code</span> <span class="token attr-name">exit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exit-code</span><span class="token punctuation">&gt;</span></span>                 <span class="token comment">// Exit code of interpreter process</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> $MODE<span class="token punctuation">:</span>Mode <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>                          <span class="token comment">// Execution mode: VMTESTS or NORMAL</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> $SCHEDULE<span class="token punctuation">:</span>Schedule <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">// Gas Schedule: DEFAULT or ALBE</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkGas</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkGas</span><span class="token punctuation">&gt;</span></span>                        <span class="token comment">// Enables/disables gas check in test driver</span>

                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>well-formedness</span><span class="token punctuation">/&gt;</span></span>

                  <span class="token comment">// IELE Specific</span>
                  <span class="token comment">// =============</span>

                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iele</span><span class="token punctuation">&gt;</span></span>

                    <span class="token comment">// Mutable during a single transaction</span>
                    <span class="token comment">// -----------------------------------</span>

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span>        <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>                  <span class="token comment">// Return registers of current call frame</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callStack</span><span class="token punctuation">&gt;</span></span>     <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callStack</span><span class="token punctuation">&gt;</span></span>               <span class="token comment">// Inter-contract call stack</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interimStates</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interimStates</span><span class="token punctuation">&gt;</span></span>           <span class="token comment">// Checkpointed network state for rollback</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substateStack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substateStack</span><span class="token punctuation">&gt;</span></span>           <span class="token comment">// Checkpointed substate for rollback</span>

                    <span class="token comment">// A single contract call frame</span>
                    <span class="token comment">// ----------------------------</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callFrame</span><span class="token punctuation">&gt;</span></span>
                      <span class="token comment">// The loaded state of a IELE program</span>
                      <span class="token comment">// ----------------------------------</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>functions</span><span class="token punctuation">&gt;</span></span>
                          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span>       deposit<span class="token punctuation">:</span>IeleName <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span>         <span class="token comment">// The name of the function</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span>      <span class="token number">0</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">// The number of parameters of the function</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks<span class="token punctuation">)</span><span class="token punctuation">:</span>Blocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token comment">// The blocks of the function</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jumpTable</span><span class="token punctuation">&gt;</span></span>    <span class="token punctuation">.</span>Map    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jumpTable</span><span class="token punctuation">&gt;</span></span>      <span class="token comment">// Map from jump label to blocks, for branch instruction</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nregs</span><span class="token punctuation">&gt;</span></span>        <span class="token number">0</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nregs</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">// Number of registers used by this function</span>
                          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>functions</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span>     <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">// Set of all names of functions in &lt;functions&gt; cell</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span>  <span class="token punctuation">.</span>Map <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span>             <span class="token comment">// Map of integer function IDS to all function names in the &lt;functions&gt; cell</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span>    <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span>               <span class="token comment">// Set of all names of functions defined with define public</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>programSize</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>programSize</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">// Size in bytes of currently loaded contract</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contractCode</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Contract <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contractCode</span><span class="token punctuation">&gt;</span></span>     <span class="token comment">// Disassembled entire contract</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span>    <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>         <span class="token comment">// Inter-contract call stack depth</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localCalls</span><span class="token punctuation">&gt;</span></span>   <span class="token punctuation">.</span>List      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localCalls</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">// Intra-contract call stack</span>

                      <span class="token comment">// I_*</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>        <span class="token number">0</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>                         <span class="token comment">// Currently executing contract</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caller</span><span class="token punctuation">&gt;</span></span>    <span class="token number">0</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caller</span><span class="token punctuation">&gt;</span></span>                     <span class="token comment">// Contract that called current contract</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span>  <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>                   <span class="token comment">// Copy of register arguments</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callValue</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callValue</span><span class="token punctuation">&gt;</span></span>                  <span class="token comment">// Value in funds passed to contract</span>

                      <span class="token comment">// \mu_*</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span>          <span class="token punctuation">.</span>Array  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>                 <span class="token comment">// Current values of registers</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span>      <span class="token punctuation">.</span>Map    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>             <span class="token comment">// Current values of local memory</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>peakMemory</span><span class="token punctuation">&gt;</span></span>    <span class="token number">0</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>peakMemory</span><span class="token punctuation">&gt;</span></span>           <span class="token comment">// Maximum memory used so far in call frame</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>currentMemory</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>currentMemory</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">// Current memory used in call frame</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span>           deposit<span class="token punctuation">:</span>IeleName <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span>                  <span class="token comment">// Name of currently executing function</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span>           <span class="token number">0</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>                  <span class="token comment">// Current gas remaining</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>previousGas</span><span class="token punctuation">&gt;</span></span>   <span class="token number">0</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>previousGas</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">// Gas remaining prior to last decrease</span>

                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>static</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>static</span><span class="token punctuation">&gt;</span></span>                        <span class="token comment">// Whether the call frame came from a staticcall</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callFrame</span><span class="token punctuation">&gt;</span></span>

                    <span class="token comment">// A_* (execution substate)</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substate</span><span class="token punctuation">&gt;</span></span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selfDestruct</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selfDestruct</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">// Set of contract ids that were destroyed by this transaction</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logData</span><span class="token punctuation">&gt;</span></span>  <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logData</span><span class="token punctuation">&gt;</span></span>                     <span class="token comment">// Log entries for this transaction</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>refund</span><span class="token punctuation">&gt;</span></span>       <span class="token number">0</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>refund</span><span class="token punctuation">&gt;</span></span>                  <span class="token comment">// Refund for this transaction</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substate</span><span class="token punctuation">&gt;</span></span>

                    <span class="token comment">// Immutable during a single transaction</span>
                    <span class="token comment">// -------------------------------------</span>

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gasPrice</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gasPrice</span><span class="token punctuation">&gt;</span></span>                          <span class="token comment">// Price of gas for this transaction</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>origin</span><span class="token punctuation">&gt;</span></span>   <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>origin</span><span class="token punctuation">&gt;</span></span>                            <span class="token comment">// Sender of current transaction</span>

                    <span class="token comment">// I_H* (block information)</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beneficiary</span><span class="token punctuation">&gt;</span></span>      <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beneficiary</span><span class="token punctuation">&gt;</span></span>      <span class="token comment">// Miner of current block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>difficulty</span><span class="token punctuation">&gt;</span></span>       <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>difficulty</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">// Difficulty of current block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span>           <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">&gt;</span></span>           <span class="token comment">// Number of current block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gasLimit</span><span class="token punctuation">&gt;</span></span>         <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gasLimit</span><span class="token punctuation">&gt;</span></span>         <span class="token comment">// Gas limit of current block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gasUsed</span><span class="token punctuation">&gt;</span></span>          <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gasUsed</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">// Gas used by current block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">&gt;</span></span>        <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timestamp</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">// Timestamp of current block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blockhash</span><span class="token punctuation">&gt;</span></span>         <span class="token punctuation">.</span>List     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blockhash</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">// List of previous block&apos;s hashes</span>

                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iele</span><span class="token punctuation">&gt;</span></span>

                  <span class="token comment">// IELE Network Layer</span>
                  <span class="token comment">// ==================</span>

                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>network</span><span class="token punctuation">&gt;</span></span>

                    <span class="token comment">// Accounts Record</span>
                    <span class="token comment">// ---------------</span>

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> <span class="token comment">// Set of keys in the accounts cell.</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span>   <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>     <span class="token comment">// ID of account</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span>  <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">// Balance of funds in account</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>     #emptyCode <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">// Disassembled contract of account</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span>  <span class="token punctuation">.</span>Map       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">// Permanent storage of account (for sload/sstore)</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span>    <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>      <span class="token comment">// Nonce of account</span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>

                    <span class="token comment">// Transactions Record</span>
                    <span class="token comment">// -------------------</span>

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>txOrder</span><span class="token punctuation">&gt;</span></span>   <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>txOrder</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">// Order of transactions in block</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>txPending</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>txPending</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">// Remaining transactions in block</span>

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>messages</span><span class="token punctuation">&gt;</span></span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>message</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>msgID</span><span class="token punctuation">&gt;</span></span>      <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>msgID</span><span class="token punctuation">&gt;</span></span>              <span class="token comment">// Unique ID of transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>txNonce</span><span class="token punctuation">&gt;</span></span>    <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>txNonce</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">// Nonce of transaction (not checked)</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>txGasPrice</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>txGasPrice</span><span class="token punctuation">&gt;</span></span>         <span class="token comment">// Gas price of transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>txGasLimit</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>txGasLimit</span><span class="token punctuation">&gt;</span></span>         <span class="token comment">// Gas limit of transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sendto</span><span class="token punctuation">&gt;</span></span>     <span class="token punctuation">.</span>Account   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sendto</span><span class="token punctuation">&gt;</span></span>             <span class="token comment">// Destination of transaction (.Account for account creation)</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>func</span><span class="token punctuation">&gt;</span></span>       deposit<span class="token punctuation">:</span>IeleName    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>func</span><span class="token punctuation">&gt;</span></span>               <span class="token comment">// Function to call by transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>      <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>              <span class="token comment">// Value in funds to transfer by transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">&gt;</span></span>       <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>               <span class="token comment">// Sender of transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">&gt;</span></span>       <span class="token punctuation">.</span>WordStack <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span>               <span class="token comment">// Arguments to function called by transaction</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>args</span><span class="token punctuation">&gt;</span></span>       <span class="token punctuation">.</span>Ints      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>args</span><span class="token punctuation">&gt;</span></span>
                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>message</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>messages</span><span class="token punctuation">&gt;</span></span>

                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>network</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> IELESimulation
    <span class="token keyword">syntax</span> Mode
    <span class="token keyword">syntax</span> Schedule
    <span class="token keyword">syntax</span> Contract <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#emptyCode&quot;</span>
 <span class="token comment">// --------------------------------</span>
</code></pre>
<h3 id="uninitialized-accounts">Uninitialized Accounts</h3>
<p>An account to which code has never been deployed has a size in bytes of zero, but contains an implicit public function <code>@deposit</code> which takes
no arguments, returns no values, and does nothing. This function exists to allow accounts to receive payment even if they do not have a contract
deployed to them. Note that a contract can forbid payments by refusing to declare the <code>@deposit</code> function, and explicitly raising an exception
if any of its entry points are invoked with a balance transfer.</p>
<p>Note that the syntax used in the following <code>#emptyCode</code> macro is desugared IELE syntax, where contracts have a size in bytes metadata attachment (<code>!0</code> here) and argument lists are replaced with an integer value representing arity (<code>0</code> here).</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> IeleNameToken <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Main&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
                      <span class="token operator">|</span> <span class="token string">&quot;iele.Wallet&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> ContractDefinition <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;contract&quot;</span> IeleName <span class="token string">&quot;!&quot;</span> <span class="token comment">/* size in bytes */</span> <span class="token keyword">Int</span> <span class="token comment">/* byte string */</span> <span class="token keyword">String</span> <span class="token string">&quot;{&quot;</span> TopLevelDefinitions <span class="token string">&quot;}&quot;</span> <span class="token comment">/* when desugared to include the code size */</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #emptyCode <span class="token operator">=&gt;</span> contract iele<span class="token punctuation">.</span>Wallet <span class="token operator">!</span><span class="token number">0</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span> define public @deposit <span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> ret <span class="token punctuation">.</span>NonEmptyOperands <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">.</span>Contract <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>

<span class="token keyword">endmodule</span>
</code></pre>
<p>The network state is closely based on the EVM blockchain,
with the state mainly consisting of information on a set of
accounts, and funds being held by accounts rather than following
the Bitcoin &quot;UTXO&quot; model.</p>
<p>Accounts are divided into smart contracts, which accept calls
and disburse funds according only to their code,
and simple wallets which can receive deposits but
contain no smart contract code, and are operated by a person
off-chain system holding a corresponding private key.</p>
<p>There is no clear division in the address space between
smart contracts and wallets, but it is intended to be
impossible for a smart contract to exist at an address for
which anybody knows a corresponding private key, so that
clients of that contract can be sure that its funds will
only be used according to the contract code.</p>
<p>When calling a function on an account, the caller may
include funds to be given to the receiver. In the syntax
of the <code>call</code> instruction this quantity comes after the
<code>send</code> keyword.
This is also the only way to transfer funds between accounts.
To allow sending funds to simple wallets, those accounts
act as if they have a single public function named <code>deposit</code>
which takes no arguments and immediately returns successfully
when called (thus keeping any funds which were sent).</p>
<p>To allow people to set up a simple wallet without needing
to send any blockchain transactions, we need to allow <code>deposit</code>
to be called on accounts that have never previously been
mentioned on the blockchain.
In this case the account is initialized as an &quot;empty&quot; account,
which has a balance but no contract code.</p>
<p>A complication is that a call to <code>deposit</code> can create such
an &quot;empty account&quot; at the address where a new smart contract
will later be created, because it is sometimes feasible
to predict the addresses of new contracts.
The prevent this from being a possible denial of service attack,
we allow the new smart contract to be created anyway in this case,
setting up its code an persistent storage and inheriting any
funds which were already held at that address.
This is a bit unfortunate but it doesn&apos;t compromise the
security guarantee that a smart contract account never exists at
an address for which anybody knows a private key.</p>
<pre class="language-k"><code><span class="token keyword">module</span> IELE<span class="token operator">-</span>INFRASTRUCTURE
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>CONFIGURATION
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>CONSTANTS
</code></pre>
<h2 id="hardware">Hardware</h2>
<p>The <code>callStack</code> cell stores a list of previous VM execution states.</p>
<ul>
<li><code>#pushCallStack</code> saves a copy of VM execution state on the <code>callStack</code>.</li>
<li><code>#popCallStack</code> restores the top element of the <code>callStack</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#pushCallStack&quot;</span>
 <span class="token comment">// --------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #pushCallStack <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callFrame</span><span class="token punctuation">&gt;</span></span> FRAME <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callFrame</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callStack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callFrame</span><span class="token punctuation">&gt;</span></span> FRAME <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callFrame</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callStack</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#popCallStack&quot;</span>
 <span class="token comment">// -------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #popCallStack <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callFrame</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> FRAME <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callFrame</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callStack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callFrame</span><span class="token punctuation">&gt;</span></span> FRAME <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callFrame</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callStack</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>The <code>interimStates</code> cell stores a list of previous world states.</p>
<ul>
<li><code>#pushWorldState</code> stores a copy of the current accounts at the top of the <code>interimStates</code> cell.</li>
<li><code>#popWorldState</code> restores the top element of the <code>interimStates</code>.</li>
<li><code>#dropWorldState</code> removes the top element of the <code>interimStates</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Accounts <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> AccountsCell <span class="token string">&quot;|&quot;</span> Set <span class="token string">&quot;}&quot;</span>
 <span class="token comment">// ------------------------------------------------</span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#pushWorldState&quot;</span>
 <span class="token comment">// ---------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #pushWorldState <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span> ACCTDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interimStates</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span> ACCTDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span> <span class="token operator">|</span> ACCTS <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interimStates</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#popWorldState&quot;</span>
 <span class="token comment">// --------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #popWorldState <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interimStates</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span> ACCTDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span> <span class="token operator">|</span> ACCTS <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interimStates</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCTDATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#dropWorldState&quot;</span>
 <span class="token comment">// ---------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #dropWorldState <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interimStates</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interimStates</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>The <code>substateStack</code> cell stores a list of previous substate logs.</p>
<ul>
<li><code>#pushSubstate</code> stores a copy of the current substate at the top of the <code>substateStack</code> cell.</li>
<li><code>#popSubstate</code> restores the top element of the <code>substateStack</code>.</li>
<li><code>#dropSubstate</code> removes the top element of the <code>substateStack</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#pushSubstate&quot;</span>
 <span class="token comment">// -------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #pushSubstate <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substate</span><span class="token punctuation">&gt;</span></span> SUBSTATE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substate</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substateStack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substate</span><span class="token punctuation">&gt;</span></span> SUBSTATE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substate</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substateStack</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#popSubstate&quot;</span>
 <span class="token comment">// ------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #popSubstate <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substate</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> SUBSTATE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substate</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substateStack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substate</span><span class="token punctuation">&gt;</span></span> SUBSTATE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substate</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substateStack</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#dropSubstate&quot;</span>
 <span class="token comment">// -------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #dropSubstate <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>K <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>substateStack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>substateStack</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Simple commands controlling exceptions provide control-flow.</p>
<ul>
<li><code>#end</code> is used to indicate the (non-exceptional) end of execution.</li>
<li><code>#exception</code> is used to indicate exceptional states (it consumes any operations to be performed after it).</li>
<li><code>#revert</code> is used to indicate the contract terminated with the revert instruction (exceptional return with error message, refunding gas).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Exception
    <span class="token keyword">syntax</span> Exception <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#exception&quot;</span> <span class="token keyword">Int</span> <span class="token operator">|</span> <span class="token string">&quot;#end&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;#revert&quot;</span> <span class="token keyword">Int</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> EX<span class="token punctuation">:</span>Exception <span class="token operator">~&gt;</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">Int</span>    <span class="token operator">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> EX<span class="token punctuation">:</span>Exception <span class="token operator">~&gt;</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span>Instruction <span class="token operator">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> EX<span class="token punctuation">:</span>Exception <span class="token operator">~&gt;</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span>Blocks <span class="token operator">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> EX<span class="token punctuation">:</span>Exception <span class="token operator">~&gt;</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span>InternalOp <span class="token operator">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;FUNC_NOT_FOUND&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;FUNC_WRONG_SIG&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;CONTRACT_NOT_FOUND&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;USER_ERROR&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;OUT_OF_GAS&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;ACCT_COLLISION&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;OUT_OF_FUNDS&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;CALL_STACK_OVERFLOW&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;CONTRACT_INVALID&quot;</span>
 <span class="token comment">// ------------------------------------</span>
    <span class="token keyword">rule</span> FUNC_NOT_FOUND      <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> FUNC_WRONG_SIG      <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> CONTRACT_NOT_FOUND  <span class="token operator">=&gt;</span> <span class="token number">3</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> USER_ERROR          <span class="token operator">=&gt;</span> <span class="token number">4</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> OUT_OF_GAS          <span class="token operator">=&gt;</span> <span class="token number">5</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> ACCT_COLLISION      <span class="token operator">=&gt;</span> <span class="token number">6</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> OUT_OF_FUNDS        <span class="token operator">=&gt;</span> <span class="token number">7</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> CALL_STACK_OVERFLOW <span class="token operator">=&gt;</span> <span class="token number">8</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
    <span class="token keyword">rule</span> CONTRACT_INVALID    <span class="token operator">=&gt;</span> <span class="token number">9</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
</code></pre>
<p>Description of registers.</p>
<ul>
<li>Registers begin with <code>%</code></li>
<li>Registers are evaluated using heating to the values they contain.</li>
<li><code>#regRange(N)</code> generates the registers 0 to N-1.</li>
</ul>
<pre class="language-k"><code>
    <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Constant
 <span class="token comment">// ---------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token operator">%</span> REG<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token operator">=&gt;</span> REGS <span class="token punctuation">[</span> REG <span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Ints
 <span class="token comment">// -----------------------</span>
    <span class="token keyword">rule</span> isKResult<span class="token punctuation">(</span><span class="token punctuation">.</span>Operands<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>

    <span class="token keyword">syntax</span> NonEmptyInts <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> lookupRegisters<span class="token punctuation">(</span>Operands<span class="token punctuation">,</span> Array<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token operator">%</span> REG<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">,</span> OPS <span class="token operator">=&gt;</span> lookupRegisters<span class="token punctuation">(</span><span class="token operator">%</span> REG<span class="token punctuation">,</span> OPS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> lookupRegisters<span class="token punctuation">(</span><span class="token operator">%</span> REG<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> OPS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> lookupRegisters<span class="token punctuation">(</span>OPS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> lookupRegisters<span class="token punctuation">(</span><span class="token punctuation">.</span>Operands<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>NonEmptyInts

    <span class="token keyword">syntax</span> LValues <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #regRange <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                     <span class="token operator">|</span> #regRange <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#regRangeAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #regRange<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #regRange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #regRange<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>LValues
    <span class="token keyword">rule</span> #regRange<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">%</span> N <span class="token punctuation">,</span> <span class="token punctuation">.</span>LValues
    <span class="token keyword">rule</span> #regRange<span class="token punctuation">(</span>N<span class="token punctuation">,</span> M<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">%</span> N <span class="token punctuation">,</span> #regRange<span class="token punctuation">(</span>N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> M <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<h3 id="execution-step">Execution Step</h3>
<p>When an instruction reaches the top of the K cell, we first heat its registers, then compute gas cost, then execute the instruction itself.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#exec&quot;</span> Instruction
                        <span class="token operator">|</span> <span class="token string">&quot;#gas&quot;</span> <span class="token string">&quot;[&quot;</span> Instruction <span class="token string">&quot;]&quot;</span> 
 <span class="token comment">// ------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> OP<span class="token punctuation">:</span>Instruction <span class="token operator">=&gt;</span> #gas <span class="token punctuation">[</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">~&gt;</span> #exec #addr<span class="token operator">?</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> isKResult<span class="token punctuation">(</span>OP<span class="token punctuation">)</span>
</code></pre>
<p>The following types of instructions do not require any register heating.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> AssignInst
    <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> JumpInst
</code></pre>
<p>Some instructions require an argument to be interpreted as an address (modulo 160 bits) or a memory cell (modulo 256 bits), so the <code>#addr?</code> function performs that check.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#addr?&quot;</span> <span class="token string">&quot;(&quot;</span> Instruction <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>balance<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>                                <span class="token operator">=&gt;</span> REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>balance<span class="token punctuation">(</span>#addr<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>extcodesize<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token operator">=&gt;</span> REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>extcodesize<span class="token punctuation">(</span>#addr<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG1 <span class="token punctuation">,</span> REG2 <span class="token operator">=</span> copycreate W0 <span class="token punctuation">(</span>REGS1<span class="token punctuation">)</span> send W1<span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> REG1 <span class="token punctuation">,</span> REG2 <span class="token operator">=</span> copycreate #addr<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token punctuation">(</span>REGS1<span class="token punctuation">)</span> send W1
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>selfdestruct W<span class="token punctuation">)</span>                                             <span class="token operator">=&gt;</span> selfdestruct #addr<span class="token punctuation">(</span>W<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REGS1 <span class="token operator">=</span> call LABEL at W0 <span class="token punctuation">(</span>REGS2<span class="token punctuation">)</span> send W1 <span class="token punctuation">,</span> gaslimit W2<span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> REGS1 <span class="token operator">=</span> call LABEL at #addr<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token punctuation">(</span>REGS2<span class="token punctuation">)</span> send W1 <span class="token punctuation">,</span> gaslimit W2
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REGS1 <span class="token operator">=</span> staticcall LABEL at W0 <span class="token punctuation">(</span>REGS2<span class="token punctuation">)</span> gaslimit W1<span class="token punctuation">)</span>         <span class="token operator">=&gt;</span> REGS1 <span class="token operator">=</span> staticcall LABEL at #addr<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token punctuation">(</span>REGS2<span class="token punctuation">)</span> gaslimit W1
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG <span class="token operator">=</span> calladdress LABEL at W0<span class="token punctuation">)</span>                              <span class="token operator">=&gt;</span> REG <span class="token operator">=</span> calladdress LABEL at #addr<span class="token punctuation">(</span>W0<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG <span class="token operator">=</span> load CELL<span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> WIDTH<span class="token punctuation">)</span>                             <span class="token operator">=&gt;</span> REG <span class="token operator">=</span> load chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span><span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> WIDTH
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG <span class="token operator">=</span> load CELL<span class="token punctuation">)</span>                                            <span class="token operator">=&gt;</span> REG <span class="token operator">=</span> load chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>store VALUE<span class="token punctuation">,</span> CELL<span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> WIDTH<span class="token punctuation">)</span>                           <span class="token operator">=&gt;</span> store VALUE<span class="token punctuation">,</span> chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span><span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> WIDTH
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>store VALUE<span class="token punctuation">,</span> CELL<span class="token punctuation">)</span>                                          <span class="token operator">=&gt;</span> store VALUE<span class="token punctuation">,</span> chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>REG <span class="token operator">=</span> sha3 CELL<span class="token punctuation">)</span>                                            <span class="token operator">=&gt;</span> REG <span class="token operator">=</span> sha3 chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>log CELL<span class="token punctuation">)</span>                                                   <span class="token operator">=&gt;</span> log chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>log CELL<span class="token punctuation">,</span> ARGS<span class="token punctuation">)</span>                                             <span class="token operator">=&gt;</span> log chop<span class="token punctuation">(</span>CELL<span class="token punctuation">)</span><span class="token punctuation">,</span> ARGS
    <span class="token keyword">rule</span> #addr<span class="token operator">?</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span>                                                         <span class="token operator">=&gt;</span> OP <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<h3 id="internal-operations">Internal Operations</h3>
<ul>
<li><code>#loadAccount_</code> allows declaring a new empty account with the given address (and assumes the rounding to 160 bits has already occured).
If the account already exists with non-zero nonce or non-empty code, an exception is thrown.
Otherwise, if the account already exists, the storage is cleared.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#loadAccount&quot;</span> <span class="token keyword">Int</span>
                        <span class="token operator">|</span> <span class="token string">&quot;#initAccount&quot;</span> <span class="token keyword">Int</span>
 <span class="token comment">// ----------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initAccount ACCT <span class="token operator">=&gt;</span> #exception ACCT_COLLISION <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>   CODE  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span>  NONCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> CODE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K #emptyCode orBool NONCE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initAccount ACCT <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span>  ACCT       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>    #emptyCode <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span>   <span class="token number">0</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Map  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount ACCT<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #initAccount ACCT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCT in ACCTS
</code></pre>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loadAccount ACCT <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token punctuation">(</span><span class="token punctuation">.</span>Set <span class="token operator">=&gt;</span> SetItem<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">(</span> <span class="token punctuation">.</span>Bag
          <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span>    ACCT       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
               <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCT in ACCTS
</code></pre>
<ul>
<li><code>#lookupStorage</code> loads the <code>&lt;storage&gt;</code> cell with the storage value for a particular key in the account.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #lookupStorage <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>
 <span class="token comment">// --------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #lookupStorage<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> INDEX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span>  ACCT    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> STORAGE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> INDEX in_keys<span class="token punctuation">(</span>STORAGE<span class="token punctuation">)</span>
</code></pre>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #lookupStorage<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> INDEX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span>  ACCT                              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> STORAGE <span class="token operator">=&gt;</span> STORAGE <span class="token punctuation">[</span> INDEX &lt;<span class="token operator">-</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool INDEX in_keys<span class="token punctuation">(</span>STORAGE<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#lookupCode</code> loads the <code>&lt;code&gt;</code> cell with the code for a particular account.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #lookupCode <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>
 <span class="token comment">// -----------------------------------------</span>
</code></pre>
<ul>
<li><code>#transferFunds</code> moves money from one account into another, creating the destination account if it doesn&apos;t exist.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#transferFunds&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span>
 <span class="token comment">// --------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #transferFunds ACCTFROM ACCTTO VALUE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> ORIGFROM <span class="token operator">=&gt;</span> ORIGFROM <span class="token operator">-</span><span class="token keyword">Int</span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> ORIGTO <span class="token operator">=&gt;</span> ORIGTO <span class="token operator">+</span><span class="token keyword">Int</span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCTFROM <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K ACCTTO andBool VALUE <span class="token operator">&lt;=</span><span class="token keyword">Int</span> ORIGFROM

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #transferFunds ACCTFROM ACCTTO VALUE <span class="token operator">=&gt;</span> #exception OUT_OF_FUNDS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> ORIGFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> VALUE &gt;<span class="token keyword">Int</span> ORIGFROM

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #loadAccount ACCTTO<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #transferFunds ACCTFROM ACCTTO VALUE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> ORIGFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCTFROM <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K ACCTTO andBool notBool ACCTTO in ACCTS andBool VALUE <span class="token operator">&lt;=</span><span class="token keyword">Int</span> ORIGFROM

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #transferFunds ACCT ACCT VALUE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> ORIGFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> VALUE <span class="token operator">&lt;=</span><span class="token keyword">Int</span> ORIGFROM
<span class="token keyword">endmodule</span>
</code></pre>
<h2 id="instruction-execution-cycle">Instruction Execution Cycle</h2>
<ul>
<li><code>#execute</code> loads the code of the currently-executing function into the <code>k</code> cell, where it executes until the function returns.
It is an exception if we try to execute a function that does not exist.</li>
</ul>
<pre class="language-k"><code><span class="token keyword">module</span> IELE
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>GAS
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>PRECOMPILED
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>PROGRAM<span class="token operator">-</span>LOADING
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>INFRASTRUCTURE

    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#execute&quot;</span>
 <span class="token comment">// ---------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #execute <span class="token operator">=&gt;</span> CODE                      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Execution follows a simple cycle where first the state is checked for exceptions, then if no exceptions will be thrown the opcode is run.</p>
<ul>
<li>If we reach the end of the function, we execute an implicit <code>ret void</code> instruction.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>LabeledBlocks <span class="token operator">=&gt;</span> ret <span class="token punctuation">.</span>NonEmptyOperands <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li>The rule for sequential composition checks if the instruction is exceptional, runs it if not, then executes the next instruction (assuming
the instruction doesn&apos;t execute a transfer of control flow).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> OP<span class="token punctuation">:</span><span class="token punctuation">:</span>Instruction OPS<span class="token punctuation">:</span><span class="token punctuation">:</span>Instructions BLOCKS<span class="token punctuation">:</span><span class="token punctuation">:</span>LabeledBlocks
          <span class="token operator">=&gt;</span> #exceptional<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">~&gt;</span> OP
          <span class="token operator">~&gt;</span> OPS BLOCKS
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>When execution reaches the end of a block, we fall through to the immediately next block.</p>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Instructions BLOCKS<span class="token punctuation">:</span><span class="token punctuation">:</span>LabeledBlocks <span class="token operator">=&gt;</span> BLOCKS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="exceptional-ops">Exceptional Ops</h3>
<p>Some checks if an opcode will throw an exception are relatively quick and done up front.</p>
<ul>
<li><code>#exceptional?</code> checks if the operator is invalid.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#exceptional?&quot;</span> <span class="token string">&quot;[&quot;</span> Instruction <span class="token string">&quot;]&quot;</span>
 <span class="token comment">// ---------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exceptional<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #invalid<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">~&gt;</span> #static<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">~&gt;</span> #negativeCall<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>#invalid?</code> checks if it&apos;s the designated invalid opcode.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> K <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#invalid?&quot;</span> <span class="token string">&quot;[&quot;</span> Instruction <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------</span>
    <span class="token keyword">rule</span> #invalid<span class="token operator">?</span> <span class="token punctuation">[</span> _ <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>invalid<span class="token punctuation">(</span><span class="token punctuation">.</span>Operands<span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #exception USER_ERROR
    <span class="token keyword">rule</span> #invalid<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#static?</code> determines if the opcode should throw an exception due to the static flag (i.e., an attempt to change state inside a contract called with <code>staticcall</code>)</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#static?&quot;</span> <span class="token string">&quot;[&quot;</span> Instruction <span class="token string">&quot;]&quot;</span>
 <span class="token comment">// ----------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #static<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>                     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>static</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>static</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #static<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>                     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>static</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>static</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> notBool #changesState<span class="token punctuation">(</span>OP<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #static<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>static</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>static</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span>         #changesState<span class="token punctuation">(</span>OP<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #changesState <span class="token punctuation">(</span> Instruction <span class="token punctuation">,</span> Array <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>log _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>log _ <span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>sstore _ <span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>_ <span class="token operator">=</span> call _ at _ <span class="token punctuation">(</span>_<span class="token punctuation">)</span> send <span class="token operator">%</span> VALUE <span class="token punctuation">,</span> gaslimit _<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token keyword">requires</span> REGS <span class="token punctuation">[</span> VALUE <span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>_ <span class="token punctuation">,</span> _ <span class="token operator">=</span> create _ <span class="token punctuation">(</span>_<span class="token punctuation">)</span> send _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>_ <span class="token punctuation">,</span> _ <span class="token operator">=</span> copycreate _ <span class="token punctuation">(</span>_<span class="token punctuation">)</span> send _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span>selfdestruct _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> #changesState<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#negativeCall?</code> throws an exception if we are making a contract call with negative value or gas limit.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#negativeCall?&quot;</span> <span class="token string">&quot;[&quot;</span> Instruction <span class="token string">&quot;]&quot;</span>
 <span class="token comment">// ----------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #negativeCall<span class="token operator">?</span> <span class="token punctuation">[</span> OP <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> notBool isAccountCallInst<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> andBool notBool isCreateInst<span class="token punctuation">(</span>OP<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #negativeCall<span class="token operator">?</span> <span class="token punctuation">[</span> _     <span class="token operator">=</span> call       _ at _ <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> send <span class="token operator">%</span> REG1 <span class="token punctuation">,</span> gaslimit <span class="token operator">%</span> REG2 <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #if getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG1 <span class="token punctuation">]</span><span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">0</span> orBool getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG2 <span class="token punctuation">]</span><span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">0</span> #then #exception USER_ERROR #else <span class="token punctuation">.</span> #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #negativeCall<span class="token operator">?</span> <span class="token punctuation">[</span> _     <span class="token operator">=</span> staticcall _ at _ <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> gaslimit <span class="token operator">%</span> REG <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #if getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG <span class="token punctuation">]</span><span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">0</span> #then #exception USER_ERROR #else <span class="token punctuation">.</span> #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #negativeCall<span class="token operator">?</span> <span class="token punctuation">[</span> _ <span class="token punctuation">,</span> _ <span class="token operator">=</span> create     _ <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> send <span class="token operator">%</span> REG <span class="token punctuation">]</span>          <span class="token operator">=&gt;</span> #if getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG <span class="token punctuation">]</span><span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">0</span> #then #exception USER_ERROR #else <span class="token punctuation">.</span> #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #negativeCall<span class="token operator">?</span> <span class="token punctuation">[</span> _ <span class="token punctuation">,</span> _ <span class="token operator">=</span> copycreate _ <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> send <span class="token operator">%</span> REG <span class="token punctuation">]</span>          <span class="token operator">=&gt;</span> #if getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG <span class="token punctuation">]</span><span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">0</span> #then #exception USER_ERROR #else <span class="token punctuation">.</span> #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="substate-log">Substate Log</h3>
<p>After executing a transaction, it&apos;s necessary to have the effect of the substate log recorded.</p>
<ul>
<li><code>#finalizeTx</code> makes the substate log actually have an effect on the state.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #finalizeTx <span class="token punctuation">(</span> <span class="token keyword">Bool</span> <span class="token punctuation">)</span>
                        <span class="token operator">|</span> #deleteAccounts <span class="token punctuation">(</span> List <span class="token punctuation">)</span>
 <span class="token comment">// ----------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #finalizeTx<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selfDestruct</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selfDestruct</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #finalizeTx<span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> VMTESTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>refund</span><span class="token punctuation">&gt;</span></span> BAL <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>refund</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> CURRBAL <span class="token operator">=&gt;</span> CURRBAL <span class="token operator">+</span><span class="token keyword">Int</span> BAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount MINER<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #finalizeTx<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> NORMAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beneficiary</span><span class="token punctuation">&gt;</span></span> MINER <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beneficiary</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool MINER in ACCTS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #finalizeTx<span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> NORMAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>txPending</span><span class="token punctuation">&gt;</span></span> ListItem<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>txPending</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #deleteAccounts<span class="token punctuation">(</span>Set2List<span class="token punctuation">(</span>ACCTS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #finalizeTx<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selfDestruct</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selfDestruct</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> size<span class="token punctuation">(</span>ACCTS<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #deleteAccounts<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span> ACCTS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #deleteAccounts<span class="token punctuation">(</span>ACCTS<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>SetItem<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Set<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">(</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
               <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
          <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag
           <span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> #deleteAccounts<span class="token punctuation">(</span><span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>
</code></pre>
<h1 id="iele-programs">IELE Programs</h1>
<p>Lists of instructions form functions in a contract.</p>
<h2 id="iele-instructions">IELE Instructions</h2>
<p>Each subsection has a different class of instructions.
Organization is based roughly on what parts of the execution state are needed to compute the result of each operator.</p>
<h3 id="invalid-operator">Invalid Operator</h3>
<p>We use an explicit call to <code>@iele.invalid</code> both for marking the designated invalid operator and for garbage bytes in the input program.
Executing the INVALID instruction results in an exception.</p>
<h3 id="register-manipulations">Register Manipulations</h3>
<p>Some operators don&apos;t calculate anything, they just manipulate the state of registers.</p>
<ul>
<li>
<p>Assigning an integer to a register is used to load immediate values into registers.</p>
</li>
<li>
<p>Assigning one register to another copies the value of the source register into the destination.</p>
</li>
<li>
<p><code>#loads</code> loads a list of integers into a list of registers. It is an exception if the number of values do not match.</p>
</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> W<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token operator">=&gt;</span> #load REG W <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG1 <span class="token operator">=</span> <span class="token operator">%</span> REG2 <span class="token operator">=&gt;</span> #load REG1 getInt<span class="token punctuation">(</span> REGS <span class="token punctuation">[</span> REG2 <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#load&quot;</span> LValue <span class="token keyword">Int</span>
                        <span class="token operator">|</span> <span class="token string">&quot;#load&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>#loadAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #load <span class="token operator">%</span> REG VALUE <span class="token operator">=&gt;</span> #load REG VALUE getInt<span class="token punctuation">(</span>REGS <span class="token punctuation">[</span> REG <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #load REG VALUE OLD <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token operator">=&gt;</span> REGS <span class="token punctuation">[</span> REG &lt;<span class="token operator">-</span> VALUE <span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>currentMemory</span><span class="token punctuation">&gt;</span></span> CURR <span class="token operator">=&gt;</span> CURR <span class="token operator">-</span><span class="token keyword">Int</span> intSize<span class="token punctuation">(</span>OLD<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> intSize<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>currentMemory</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#loads&quot;</span> LValues Ints
 <span class="token comment">// -------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loads <span class="token punctuation">(</span>REG <span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token punctuation">(</span>VALUE <span class="token punctuation">,</span> VALUES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG VALUE <span class="token operator">~&gt;</span> #loads REGS VALUES <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loads <span class="token punctuation">.</span>LValues     <span class="token punctuation">.</span>Ints            <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>K                                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loads <span class="token punctuation">(</span>REG <span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token punctuation">.</span>Ints            <span class="token operator">=&gt;</span> #exception FUNC_WRONG_SIG             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #loads <span class="token punctuation">.</span>LValues     <span class="token punctuation">(</span>VALUE <span class="token punctuation">,</span> VALUES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception FUNC_WRONG_SIG             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="local-memory">Local Memory</h3>
<p>These operations are getters/setters of the local execution memory.</p>
<ul>
<li><code>REG = load CELL, OFFSET, WIDTH</code> loads WIDTH bytes starting at OFFSET in the specified memory CELL into REG, interpreted as a signed integer.</li>
<li><code>REG = load CELL</code> loads the entire value in CELL into REG, interpreted as a signed integer.</li>
<li><code>REG = store VALUE, CELL, OFFSET, WIDTH</code> stores VALUE into the specified memory CELL at OFFSET, interpreting it modulo 256^WIDTH.</li>
<li><code>REG = store VALUE, CELL</code> stores VALUE into the specified memory CELL, overwriting the previous value of the entire cell.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> load CELL <span class="token punctuation">,</span> OFFSET <span class="token punctuation">,</span> WIDTH <span class="token operator">=&gt;</span> #load REG Bytes2Int<span class="token punctuation">(</span>LM <span class="token punctuation">[</span> OFFSET <span class="token punctuation">.</span><span class="token punctuation">.</span> WIDTH <span class="token punctuation">]</span><span class="token punctuation">,</span> LE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> CELL <span class="token operator">|</span><span class="token operator">-</span>&gt; LM <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> load CELL <span class="token punctuation">,</span> OFFSET <span class="token punctuation">,</span> WIDTH <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool CELL in_keys<span class="token punctuation">(</span>LM<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> load CELL <span class="token operator">=&gt;</span> #load REG Bytes2Int<span class="token punctuation">(</span>LM<span class="token punctuation">,</span> LE<span class="token punctuation">,</span> Signed<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> CELL <span class="token operator">|</span><span class="token operator">-</span>&gt; LM <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> load CELL <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool CELL in_keys<span class="token punctuation">(</span>LM<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec store VALUE <span class="token punctuation">,</span> CELL <span class="token punctuation">,</span> OFFSET <span class="token punctuation">,</span> WIDTH <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> CELL <span class="token operator">|</span><span class="token operator">-</span>&gt; <span class="token punctuation">(</span>LM <span class="token operator">=&gt;</span> LM <span class="token punctuation">[</span> OFFSET <span class="token punctuation">:</span><span class="token operator">=</span> Int2Bytes<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span> twos<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span> VALUE<span class="token punctuation">)</span><span class="token punctuation">,</span> LE<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec store _ <span class="token punctuation">,</span> CELL <span class="token punctuation">,</span> _ <span class="token punctuation">,</span> WIDTH <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token punctuation">(</span><span class="token punctuation">.</span>Map <span class="token operator">=&gt;</span> CELL <span class="token operator">|</span><span class="token operator">-</span>&gt; <span class="token punctuation">.</span>Bytes<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool CELL in_keys<span class="token punctuation">(</span>LM<span class="token punctuation">)</span> andBool WIDTH <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec store _ <span class="token punctuation">,</span> CELL <span class="token punctuation">,</span> _ <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool CELL in_keys<span class="token punctuation">(</span>LM<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec store VALUE <span class="token punctuation">,</span> CELL <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token operator">=&gt;</span> #if VALUE <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool notBool CELL in_keys<span class="token punctuation">(</span>LM<span class="token punctuation">)</span> #then LM #else LM <span class="token punctuation">[</span> CELL &lt;<span class="token operator">-</span> Int2Bytes<span class="token punctuation">(</span>VALUE<span class="token punctuation">,</span> LE<span class="token punctuation">,</span> Signed<span class="token punctuation">)</span> <span class="token punctuation">]</span> #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="expressions">Expressions</h3>
<p>Expression calculations are simple and don&apos;t require anything but the arguments from the <code>regs</code> to operate.</p>
<ul>
<li>
<p><code>REG = iszero W</code> performs boolean negation on W.</p>
</li>
<li>
<p><code>REG = not W</code> performs bitwise negation on W.</p>
</li>
<li>
<p><code>REG = add W0, W1</code> performs arbitrary-precision addition on W0 and W1.</p>
</li>
<li>
<p><code>REG = sub W0, W1</code> performs arbitrary-precision subtraction on W0 and W1.</p>
</li>
<li>
<p><code>REG = mul W0, W1</code> performs arbitrary-precision multiplication on W0 and W1.</p>
</li>
<li>
<p><code>REG = div W0, W1</code> performs arbitrary-precision t-division on W0 and W1. It is an exception to divide by zero.</p>
</li>
<li>
<p><code>REG = mod W0, W1</code> performs arbitrary-precision t-modulus on W0 and W1. It is an exception to modulus by zero.</p>
</li>
<li>
<p><code>REG = exp W0, W1</code> performs arbitrary-precision exponentiation on W0 and W1. It is an exception to exponentiate by a negative number.</p>
</li>
<li>
<p><code>REG = addmod W0, W1, W2</code> performs addition of W0 and W1 modulo W2. It is an exception to modulus by zero.</p>
</li>
<li>
<p><code>REG = mulmod W0, W1, W2</code> performs multiplication of W0 and W1 modulo W2. It is an exception to modulus by zero.</p>
</li>
<li>
<p><code>REG = expmod W0, W1, W2</code> performs exponentiation of W0 and W1 modulo W2. It is an exception to exponentiate by a negative number or modulus by zero.</p>
</li>
<li>
<p><code>REG = log2 W</code> performs the floored logarithm base 2 of W. It is an exception to compute the logarithm of 0 or of a negative number.</p>
</li>
<li>
<p><code>REG = and W0, W1</code> performs bitwise AND on W0 and W1.</p>
</li>
<li>
<p><code>REG = or W0, W1</code> performs bitwise inclusive OR on W0 and W1.</p>
</li>
<li>
<p><code>REG = xor W0, W1</code> performs bitwise exclusive OR on W0 and W1.</p>
</li>
<li>
<p><code>REG = shift W0, W1</code> performs bitwise shifting of W0 by W1 bits. If W1 is positive, a left shift occurs; if W1 is negative, a right shift occurs.</p>
</li>
<li>
<p><code>REG = cmp lt W0, W1</code> computes if W0 is less than W1.</p>
</li>
<li>
<p><code>REG = cmp le W0, W1</code> computes if W0 is less than or equal to W1.</p>
</li>
<li>
<p><code>REG = cmp gt W0, W1</code> computes if W0 is greater than W1.</p>
</li>
<li>
<p><code>REG = cmp ge W0, W1</code> computes if W0 is greater than or equal to W1.</p>
</li>
<li>
<p><code>REG = cmp eq W0, W1</code> computes if W0 is equal to W1.</p>
</li>
<li>
<p><code>REG = cmp ne W0, W1</code> computes if W0 is not equal to W1.</p>
</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> iszero <span class="token number">0</span> <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> iszero W <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> not W    <span class="token operator">=&gt;</span> #load REG <span class="token operator">~</span><span class="token keyword">Int</span> W <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> add W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">+</span><span class="token keyword">Int</span> W1  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> mul W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">*</span><span class="token keyword">Int</span> W1  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> sub W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">-</span><span class="token keyword">Int</span> W1  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> div W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">/</span><span class="token keyword">Int</span> W1  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> div W0 <span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> exp W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">^</span><span class="token keyword">Int</span> W1  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> exp W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">0</span>
    <span class="token attr-name">rule</span> <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> mod W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">%</span><span class="token keyword">Int</span> W1  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> mod W0 <span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> addmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span> W2 <span class="token operator">=&gt;</span> #load REG <span class="token punctuation">(</span>W0 <span class="token operator">+</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token keyword">Int</span> W2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W2 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> addmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token operator">=&gt;</span> #exception USER_ERROR          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> mulmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span> W2 <span class="token operator">=&gt;</span> #load REG <span class="token punctuation">(</span>W0 <span class="token operator">*</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token keyword">Int</span> W2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W2 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> mulmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token operator">=&gt;</span> #exception USER_ERROR          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> expmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span> W2 <span class="token operator">=&gt;</span> #load REG powmod<span class="token punctuation">(</span>W0<span class="token punctuation">,</span>W1<span class="token punctuation">,</span>W2<span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W2 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool <span class="token punctuation">(</span>W1 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> orBool gcdInt<span class="token punctuation">(</span>W0<span class="token punctuation">,</span> W2<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> expmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token operator">=&gt;</span> #exception USER_ERROR          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> expmod W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span> W2 <span class="token operator">=&gt;</span> #exception USER_ERROR          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 &lt;<span class="token keyword">Int</span> <span class="token number">0</span> andBool gcdInt<span class="token punctuation">(</span>W0<span class="token punctuation">,</span> W2<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">1</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> byte  INDEX <span class="token punctuation">,</span> W <span class="token operator">=&gt;</span> #load REG byte<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>INDEX<span class="token punctuation">)</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> sext  WIDTH <span class="token punctuation">,</span> W <span class="token operator">=&gt;</span> #load REG signextend<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> sext  WIDTH <span class="token punctuation">,</span> W <span class="token operator">=&gt;</span> #exception USER_ERROR                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">0</span>
    <span class="token attr-name">rule</span> <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> twos  WIDTH <span class="token punctuation">,</span> W <span class="token operator">=&gt;</span> #load REG twos<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> bswap WIDTH <span class="token punctuation">,</span> W <span class="token operator">=&gt;</span> #load REG bswap<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> bswap WIDTH <span class="token punctuation">,</span> W <span class="token operator">=&gt;</span> #exception USER_ERROR                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">0</span>

    <span class="token attr-name">rule</span> <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> log2 W <span class="token operator">=&gt;</span> #load REG log2Int<span class="token punctuation">(</span>W<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> log2 W <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W <span class="token operator">&lt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> and   W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">&amp;</span><span class="token keyword">Int</span> W1   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> or    W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 <span class="token operator">|</span><span class="token keyword">Int</span> W1   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> xor   W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 xorInt W1 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> shift W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 &lt;&lt;<span class="token keyword">Int</span> W1 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> shift W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG W0 &gt;&gt;<span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> W1 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">0</span>

    <span class="token attr-name">rule</span> <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp lt W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span>   <span class="token attr-name">W1</span>
    <span class="token attr-name">rule</span> <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp lt W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span>  W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp le W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">&lt;=</span><span class="token keyword">Int</span>  W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp le W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 &gt;<span class="token keyword">Int</span>   W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp gt W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 &gt;<span class="token keyword">Int</span>   W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp gt W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">&lt;=</span><span class="token keyword">Int</span>  W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp ge W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span>  W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp ge W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span>   <span class="token attr-name">W1</span>
    <span class="token attr-name">rule</span> <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp eq W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">==</span><span class="token keyword">Int</span>  W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp eq W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp ne W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> W1
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> cmp ne W0 <span class="token punctuation">,</span> W1 <span class="token operator">=&gt;</span> #load REG <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>  <span class="token keyword">requires</span> W0 <span class="token operator">==</span><span class="token keyword">Int</span>  W1

</code></pre>
<h3 id="hashing">Hashing</h3>
<p>The sha3 instruction computes the keccak256 hash of an entire memory cell.</p>
<pre class="language-k"><code>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> sha3 MEMINDEX <span class="token operator">=&gt;</span> #load REG keccak<span class="token punctuation">(</span>LM<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> MEMINDEX <span class="token operator">|</span><span class="token operator">-</span>&gt; LM <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> sha3 MEMINDEX <span class="token operator">=&gt;</span> #load REG keccak<span class="token punctuation">(</span><span class="token punctuation">.</span>Bytes<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span> LM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool MEMINDEX in_keys<span class="token punctuation">(</span>LM<span class="token punctuation">)</span>
</code></pre>
<h3 id="local-state">Local State</h3>
<p>These operators make queries about the current execution state.</p>
<ul>
<li><code>REG = call @iele.gas()</code> returns the gas remaining after executing the current instruction.</li>
<li><code>REG = call @iele.gasprice()</code> returns the gas price of the transaction. This will be removed when we migrate to Cardano.</li>
<li><code>REG = call @iele.gaslimit()</code> returns the gas limit of the current block.</li>
<li><code>REG = call @iele.beneficiary()</code> returns the account who receives payment for mining the current transaction.</li>
<li><code>REG = call @iele.timestamp()</code> returns the time stamp of the current block.</li>
<li><code>REG = call @iele.number()</code> returns the block number of the current block.</li>
<li><code>REG = call @iele.difficulty()</code> returns the difficulty of the current block. This will be removed when we migrate to Cardano.</li>
<li><code>REG = call @iele.address()</code> returns the address of the currently executing account.</li>
<li><code>REG = call @iele.origin()</code> returns the original sender of the current transaction.</li>
<li><code>REG = call @iele.caller()</code> returns the caller of the current contract call.</li>
<li><code>REG = call @iele.callvalue()</code> returns the value transfer of the current contract call.</li>
<li><code>REG = call @iele.msize()</code> returns the current peak memory usage of the current contract call.</li>
<li><code>REG = call @iele.codesize()</code> returns the size in bytes of the currently executing contract.</li>
<li><code>REG = call @iele.blockhash(N)</code> returns the hash of the block header of the Nth previous block.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>gas      <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG <span class="token punctuation">(</span>GAVAIL <span class="token operator">/</span><span class="token keyword">Int</span> Sgasdivisor &lt; SCHED &gt;<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>gasprice <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG GPRICE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gasPrice</span><span class="token punctuation">&gt;</span></span> GPRICE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gasPrice</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>gaslimit <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG GLIMIT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gasLimit</span><span class="token punctuation">&gt;</span></span> GLIMIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gasLimit</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>beneficiary <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG CB   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beneficiary</span><span class="token punctuation">&gt;</span></span> CB <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beneficiary</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>timestamp   <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG TS   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">&gt;</span></span> TS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timestamp</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>number      <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG NUMB <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> NUMB <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>difficulty  <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG DIFF <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>difficulty</span><span class="token punctuation">&gt;</span></span> DIFF <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>difficulty</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>address   <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG ACCT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>origin    <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG ORG  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>origin</span><span class="token punctuation">&gt;</span></span> ORG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>origin</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>caller    <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG CL   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caller</span><span class="token punctuation">&gt;</span></span> CL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caller</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>callvalue <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #load REG CV   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callValue</span><span class="token punctuation">&gt;</span></span> CV <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callValue</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>msize    <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG <span class="token punctuation">(</span>MU &lt;&lt;<span class="token keyword">Int</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>peakMemory</span><span class="token punctuation">&gt;</span></span> MU <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>peakMemory</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>codesize <span class="token punctuation">(</span> <span class="token punctuation">.</span>Ints <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG SIZE         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>programSize</span><span class="token punctuation">&gt;</span></span> SIZE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>programSize</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>blockhash <span class="token punctuation">(</span> N <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG #if N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> HI orBool HI <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">256</span> &gt;<span class="token keyword">Int</span> N orBool N &lt;<span class="token keyword">Int</span> <span class="token number">0</span> #then <span class="token number">0</span> #else #parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>Int2String<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> HI <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> VMTESTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>blockhash <span class="token punctuation">(</span> N <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG #blockhash<span class="token punctuation">(</span>HASHES<span class="token punctuation">,</span> N<span class="token punctuation">,</span> HI <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> HI <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blockhash</span><span class="token punctuation">&gt;</span></span> HASHES <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blockhash</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> NORMAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #blockhash <span class="token punctuation">(</span> List <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #blockhash<span class="token punctuation">(</span>_<span class="token punctuation">,</span> N<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token keyword">requires</span> N &gt;<span class="token keyword">Int</span> HI orBool N &lt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #blockhash<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #blockhash<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #blockhash<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>H<span class="token punctuation">)</span> _<span class="token punctuation">,</span> N<span class="token punctuation">,</span> N<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> H
    <span class="token keyword">rule</span> #blockhash<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>_<span class="token punctuation">)</span> L<span class="token punctuation">,</span> N<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> A<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #blockhash<span class="token punctuation">(</span>L<span class="token punctuation">,</span> N<span class="token punctuation">,</span> HI <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> A <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<h3 id="branch-and-local-call">Branch and Local Call</h3>
<p>The <code>br</code> instruction jumps to a specified label, either unconditionally, or if its argument is nonzero.</p>
<p>The call instruction for local calls (i.e. the form which does not specify an account, value, or gas limit), calls a function in the current contract.
The called function executes in the same contract call frame (i.e. with the same value, gas limit, and memory), but with a fresh set of local registers.
When execution of the callee reaches a <code>ret</code> instruction, control returns to the instruction following the call, and local registers are restored.</p>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> _<span class="token punctuation">:</span>IeleName <span class="token punctuation">:</span> INSTRS BLOCKS<span class="token punctuation">:</span><span class="token punctuation">:</span>LabeledBlocks <span class="token operator">=&gt;</span> INSTRS BLOCKS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec br LABEL <span class="token operator">~&gt;</span> _<span class="token punctuation">:</span>Blocks <span class="token operator">=&gt;</span> CODE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jumpTable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> LABEL <span class="token operator">|</span><span class="token operator">-</span>&gt; CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jumpTable</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec br I<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">,</span> LABEL <span class="token operator">~&gt;</span> _<span class="token punctuation">:</span>Blocks <span class="token operator">=&gt;</span> CODE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jumpTable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> LABEL <span class="token operator">|</span><span class="token operator">-</span>&gt; CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jumpTable</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> I <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec br <span class="token number">0</span><span class="token punctuation">,</span> LABEL          <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> LocalCall <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> Blocks <span class="token string">&quot;|&quot;</span> IeleName <span class="token string">&quot;|&quot;</span> LValues <span class="token string">&quot;|&quot;</span> Array <span class="token string">&quot;}&quot;</span>
 <span class="token comment">// ----------------------------------------------------------------------</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec RETURNS <span class="token operator">=</span> call @ LABEL <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> <span class="token operator">~&gt;</span> OPS<span class="token punctuation">:</span>Blocks <span class="token operator">=&gt;</span> #loads #regRange<span class="token punctuation">(</span>#sizeRegs<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span><span class="token punctuation">)</span> ARGS <span class="token operator">~&gt;</span> #execute <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token operator">=&gt;</span> LABEL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> REGS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Array <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localCalls</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> OPS <span class="token operator">|</span> FUNC <span class="token operator">|</span> RETURNS <span class="token operator">|</span> REGS <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localCalls</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool isIeleBuiltin<span class="token punctuation">(</span>LABEL<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec _ <span class="token operator">=</span> call <span class="token punctuation">(</span>IDX<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token operator">=&gt;</span> @ LABEL<span class="token punctuation">)</span> <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> IDX <span class="token operator">|</span><span class="token operator">-</span>&gt; LABEL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> LABEL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> NPARAMS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #sizeRegs<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> NPARAMS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec _ <span class="token operator">=</span> call IDX<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception FUNC_NOT_FOUND <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> LBLS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool IDX in_keys<span class="token punctuation">(</span>LBLS<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec _ <span class="token operator">=</span> call IDX<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #if LABEL <span class="token operator">==</span>K init andBool SCHED <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K ALBE #then FUNC_NOT_FOUND #else #exception FUNC_WRONG_SIG #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> IDX <span class="token operator">|</span><span class="token operator">-</span>&gt; LABEL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> LABEL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> NPARAMS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #sizeRegs<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> NPARAMS orBool <span class="token punctuation">(</span>LABEL <span class="token operator">==</span>K init andBool SCHED <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K ALBE<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> isIeleBuiltin<span class="token punctuation">(</span>IeleName<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>invalid<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>gas<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>gasprice<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>gaslimit<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>beneficiary<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>difficulty<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>origin<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>caller<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>callvalue<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>msize<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>codesize<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>blockhash<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>balance<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>extcodesize<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecrec<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>rip160<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecadd<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecmul<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecpairing<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>
    <span class="token keyword">rule</span> isIeleBuiltin<span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<h3 id="ret-and-revert"><code>ret</code> and <code>revert</code></h3>
<ul>
<li><code>ret</code> returns the values contained in the specified list of registers to the caller.
If we are executing inside a previous local call, the contract call frame persists unchanged, and only the instruction position and local register are affected.
If we are executing at the top-level local call of a contract call frame, we return to the contract call&apos;s caller.</li>
<li><code>revert</code> returns the value of the single specified register to the contract call&apos;s caller, but signifies that the contract has failed, which rolls back state changes and returns an error code to the caller.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ret VALUES <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> VALUES <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localCalls</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localCalls</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ret VALUES <span class="token operator">~&gt;</span> _<span class="token punctuation">:</span>Blocks <span class="token operator">=&gt;</span> #registerDeltas<span class="token punctuation">(</span>RETURNS<span class="token punctuation">,</span> VALUES<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #loads RETURNS VALUES <span class="token operator">~&gt;</span> OPS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> REGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localCalls</span><span class="token punctuation">&gt;</span></span> ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> OPS <span class="token operator">|</span> FUNC <span class="token operator">|</span> RETURNS <span class="token operator">|</span> REGS <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localCalls</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec revert VALUE <span class="token operator">=&gt;</span> #revert VALUE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="log-operations">Log Operations</h3>
<p>During execution of a transaction some things are recorded in the substate log.
This is a right cons-list of <code>SubstateLogEntry</code> (which contains the account ID along with the specified portions of the <code>wordStack</code> and <code>localMem</code>).</p>
<p>The <code>log</code> instruction logs an entire memory cell to the substate log with zero to four log topics.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> SubstateLogEntry <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;|&quot;</span> List <span class="token string">&quot;|&quot;</span> Bytes <span class="token string">&quot;}&quot;</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>logEntry<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------</span>
</code></pre>
<pre class="language-k"><code>    <span class="token keyword">rule</span> #exec log MEMINDEX                     <span class="token operator">=&gt;</span> #log MEMINDEX <span class="token punctuation">.</span>List
    <span class="token keyword">rule</span> #exec log MEMINDEX <span class="token punctuation">,</span> W0                <span class="token operator">=&gt;</span> #log MEMINDEX ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W0<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #exec log MEMINDEX <span class="token punctuation">,</span> W0 <span class="token punctuation">,</span> W1           <span class="token operator">=&gt;</span> #log MEMINDEX ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W0<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W1<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #exec log MEMINDEX <span class="token punctuation">,</span> W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span> W2      <span class="token operator">=&gt;</span> #log MEMINDEX ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W0<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W1<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #exec log MEMINDEX <span class="token punctuation">,</span> W0 <span class="token punctuation">,</span> W1 <span class="token punctuation">,</span> W2 <span class="token punctuation">,</span> W3 <span class="token operator">=&gt;</span> #log MEMINDEX ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W0<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W1<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W2<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>W3<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#log&quot;</span> <span class="token keyword">Int</span> List
 <span class="token comment">// -------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #log MEMINDEX TOPICS <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> MEMINDEX <span class="token operator">|</span><span class="token operator">-</span>&gt; LM <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logData</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> ACCT <span class="token operator">|</span> TOPICS <span class="token operator">|</span> LM <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logData</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="network-ops">Network Ops</h2>
<p>Operators that require access to the rest of the IELE network world-state can be taken as a first draft of a &quot;blockchain generic&quot; language.</p>
<h3 id="account-queries">Account Queries</h3>
<ul>
<li><code>REG = call @iele.balance(ACCT)</code> returns the balance of the specified account (zero if the account does not exist).</li>
<li><code>REG = call @iele.extcodesize(ACCT)</code> returns the code si of the specified account (zero if the account does not exist).</li>
<li><code>REG = calladdress NAME at ACCT</code> returns the function pointer pointing to the function named NAME on the specified account (zero if the function does not exist)</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>balance <span class="token punctuation">(</span> ACCT <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG BAL <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount ACCT<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>balance <span class="token punctuation">(</span> ACCT <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCT in ACCTS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>extcodesize <span class="token punctuation">(</span> ACCT <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #load REG #contractSize<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> #mainContract<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
       <span class="token keyword">requires</span> CODE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Contract

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #lookupCode<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec _ <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>extcodesize <span class="token punctuation">(</span> ACCT <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Contract <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount ACCT<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec _ <span class="token operator">=</span> call @iele<span class="token punctuation">.</span>extcodesize <span class="token punctuation">(</span> ACCT <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCT in ACCTS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount ACCT<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec _ <span class="token operator">=</span> calladdress _ at ACCT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool ACCT in ACCTS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #lookupCode<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec _ <span class="token operator">=</span> calladdress _ at ACCT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Contract <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> calladdress @ NAME at ACCT <span class="token operator">=&gt;</span> #load REG #callAddress<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> #mainContract<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span><span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
       <span class="token keyword">requires</span> CODE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Contract
</code></pre>
<h3 id="account-storage-operations">Account Storage Operations</h3>
<p>These operations interact with the account storage.</p>
<ul>
<li><code>REG = sload INDEX</code> loads the word at INDEX from the account storage.</li>
<li><code>sstore VALUE, INDEX</code> stores the VALUE at INDEX in the account storage.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token operator">=</span> sload INDEX <span class="token operator">=&gt;</span> #load REG VALUE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> INDEX <span class="token operator">|</span><span class="token operator">-</span>&gt; VALUE <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec sstore VALUE <span class="token punctuation">,</span> INDEX <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>storage</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>INDEX <span class="token operator">|</span><span class="token operator">-</span>&gt; <span class="token punctuation">(</span>OLD <span class="token operator">=&gt;</span> VALUE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>storage</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>refund</span><span class="token punctuation">&gt;</span></span> R <span class="token operator">=&gt;</span> R <span class="token operator">+</span><span class="token keyword">Int</span> Rsstoreset &lt; SCHED &gt; <span class="token operator">*</span><span class="token keyword">Int</span> maxInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> intSize<span class="token punctuation">(</span>OLD<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> intSize<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>refund</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="call-operations">Call Operations</h3>
<p>The various <code>call*</code> (and other inter-contract control flow) operations will be desugared into these <code>InternalOp</code>s.</p>
<ul>
<li><code>#checkCall</code> checks that the current account has the balance necessary to invoke the contract call, and that the contract call stack depth limit has not been reached.</li>
<li><code>#call_____</code> takes the calling account, the account to execute as, the account whose code should execute, the gas limit, the amount to transfer, the function to call, and the arguments.</li>
<li><code>#callWithCode______</code> takes the calling account, the accout to execute as, the code to execute (as a map), the gas limit, the amount to transfer, the function to call, and the arguments.</li>
<li><code>#return__</code> is a placeholder for the calling program, specifying where to place the returned data in registers.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#checkCall&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span>
                        <span class="token operator">|</span> <span class="token string">&quot;#call&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> Constant Operand <span class="token keyword">Int</span> Ints <span class="token keyword">Bool</span> <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                        <span class="token operator">|</span> <span class="token string">&quot;#callWithCode&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> ProgramCell Constant <span class="token keyword">Int</span> <span class="token keyword">Int</span> Ints <span class="token keyword">Bool</span>
                        <span class="token operator">|</span> <span class="token string">&quot;#mkCall&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> ProgramCell IeleName <span class="token keyword">Int</span> <span class="token keyword">Int</span> Ints <span class="token keyword">Bool</span>
 <span class="token comment">// ----------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkCall ACCT VALUE GCAP <span class="token operator">~&gt;</span> #call _ _ _ GLIMIT _ _ _ <span class="token operator">=&gt;</span> #refund GLIMIT <span class="token operator">~&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate <span class="token operator">~&gt;</span> #exception <span class="token punctuation">(</span>#if VALUE &gt;<span class="token keyword">Int</span> BAL #then OUT_OF_FUNDS #else CALL_STACK_OVERFLOW #fi<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> VALUE &gt;<span class="token keyword">Int</span> BAL orBool CD <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">1024</span>

     <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkCall ACCT VALUE GCAP <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>VALUE &gt;<span class="token keyword">Int</span> BAL orBool CD <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call ACCTFROM ACCTTO FUNC GLIMIT<span class="token punctuation">:</span><span class="token keyword">Int</span> VALUE ARGS STATIC
          <span class="token operator">=&gt;</span> #callWithCode ACCTFROM ACCTTO #precompiled FUNC GLIMIT VALUE ARGS STATIC
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCTTO <span class="token operator">==</span><span class="token keyword">Int</span> #precompiledAccount

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #call ACCTFROM ACCTTO FUNC GLIMIT<span class="token punctuation">:</span><span class="token keyword">Int</span> VALUE ARGS STATIC
          <span class="token operator">=&gt;</span> #callWithCode ACCTFROM ACCTTO #loadCode<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span> FUNC GLIMIT VALUE ARGS STATIC
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCTTO <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> #precompiledAccount andBool CODE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Contract

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #lookupCode<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #call _ ACCT _ _ _ _ _ <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Contract <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCT <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> #precompiledAccount

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount ACCT<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #call _ ACCT _ _ _ _ _ <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCT <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> #precompiledAccount andBool notBool ACCT in ACCTS

    <span class="token keyword">rule</span> #callWithCode ACCTFROM ACCTTO CODE @ FUNC GLIMIT VALUE ARGS STATIC
      <span class="token operator">=&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate
      <span class="token operator">~&gt;</span> #transferFunds ACCTFROM ACCTTO VALUE
      <span class="token operator">~&gt;</span> #mkCall ACCTFROM ACCTTO CODE FUNC GLIMIT VALUE ARGS STATIC

    <span class="token keyword">rule</span> #callWithCode ACCTFROM ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> LBLS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span> IDX<span class="token punctuation">:</span><span class="token keyword">Int</span> GLIMIT VALUE ARGS STATIC
      <span class="token operator">=&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate <span class="token operator">~&gt;</span> #exception FUNC_NOT_FOUND
      <span class="token keyword">requires</span> notBool IDX in_keys<span class="token punctuation">(</span>LBLS<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #callWithCode ACCTFROM ACCTTO <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> IDX <span class="token operator">|</span><span class="token operator">-</span>&gt; FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span> #as CODE<span class="token punctuation">)</span> IDX<span class="token punctuation">:</span><span class="token keyword">Int</span> GLIMIT VALUE ARGS STATIC
      <span class="token operator">=&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate
      <span class="token operator">~&gt;</span> #transferFunds ACCTFROM ACCTTO VALUE
      <span class="token operator">~&gt;</span> #mkCall ACCTFROM ACCTTO CODE FUNC GLIMIT VALUE ARGS STATIC

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #mkCall ACCTFROM ACCTTO CODE FUNC GLIMIT VALUE ARGS STATIC<span class="token punctuation">:</span><span class="token keyword">Bool</span>
          <span class="token operator">=&gt;</span> #initVM<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #initFun<span class="token punctuation">(</span>FUNC<span class="token punctuation">,</span> #sizeRegs<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token operator">=&gt;</span> CD <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ARGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callValue</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callValue</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> GLIMIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caller</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caller</span><span class="token punctuation">&gt;</span></span>
         <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> _ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=&gt;</span> CODE<span class="token punctuation">:</span>ProgramCell<span class="token punctuation">)</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>static</span><span class="token punctuation">&gt;</span></span> OLDSTATIC<span class="token punctuation">:</span><span class="token keyword">Bool</span> <span class="token operator">=&gt;</span> OLDSTATIC orBool STATIC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>static</span><span class="token punctuation">&gt;</span></span>

</code></pre>
<p>The VM starts out with empty memory, output, registers, and local call stack.
If the function being called is not public, does not exist, or has the wrong number of arguments, an exception is raised.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #initVM <span class="token punctuation">(</span> Ints <span class="token punctuation">)</span>
                   <span class="token operator">|</span> #initFun <span class="token punctuation">(</span> IeleName <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Bool</span> <span class="token punctuation">)</span>
 <span class="token comment">// ---------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initVM<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #loads #regRange<span class="token punctuation">(</span>#sizeRegs<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span><span class="token punctuation">)</span> ARGS <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>currentMemory</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token number">0</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>currentMemory</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>peakMemory</span><span class="token punctuation">&gt;</span></span>    _ <span class="token operator">=&gt;</span> <span class="token number">0</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>peakMemory</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span>        _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>regs</span><span class="token punctuation">&gt;</span></span>          _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Array <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>regs</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localMem</span><span class="token punctuation">&gt;</span></span>      _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Map   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localMem</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localCalls</span><span class="token punctuation">&gt;</span></span>    _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localCalls</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initFun<span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception FUNC_NOT_FOUND <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span> FUNCS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span> LABELS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool LABEL in FUNCS
               andBool LABEL in LABELS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initFun<span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception <span class="token punctuation">(</span>#if SIZE <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span> #then CONTRACT_NOT_FOUND #else FUNC_NOT_FOUND #fi<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span> LABELS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>programSize</span><span class="token punctuation">&gt;</span></span> SIZE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>programSize</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool LABEL in LABELS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initFun<span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> NARGS<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception FUNC_WRONG_SIG <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> LABEL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> NPARAMS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> NARGS <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> NPARAMS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #initFun<span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> NARGS<span class="token punctuation">,</span> ISCREATE<span class="token punctuation">:</span><span class="token keyword">Bool</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #if EXECMODE <span class="token operator">==</span>K VMTESTS #then #end #else #execute #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SetItem<span class="token punctuation">(</span>LABEL<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span> FUNCS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fid</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> LABEL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fid</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nregs</span><span class="token punctuation">&gt;</span></span> REGISTERS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nregs</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>currentMemory</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> REGISTERS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>currentMemory</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>peakMemory</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> REGISTERS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>peakMemory</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> LABEL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> NPARAMS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> <span class="token punctuation">(</span>LABEL in FUNCS orBool ISCREATE<span class="token punctuation">)</span> andBool <span class="token punctuation">(</span>NPARAMS <span class="token operator">==</span><span class="token keyword">Int</span> NARGS<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#return&quot;</span> LValues LValue
 <span class="token comment">// -----------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exception STATUS <span class="token operator">~&gt;</span> #return _ REG
          <span class="token operator">=&gt;</span> #popCallStack <span class="token operator">~&gt;</span> #popWorldState <span class="token operator">~&gt;</span> #popSubstate <span class="token operator">~&gt;</span> #registerDelta<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #load REG STATUS
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #revert OUT <span class="token operator">~&gt;</span> #return _ REG
           <span class="token operator">=&gt;</span> #popCallStack
           <span class="token operator">~&gt;</span> #popWorldState
           <span class="token operator">~&gt;</span> #popSubstate
           <span class="token operator">~&gt;</span> #registerDelta<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> intSize<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token operator">~&gt;</span> #load REG OUT <span class="token operator">~&gt;</span> #refund GAVAIL
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #end <span class="token operator">~&gt;</span> #return REGS REG
          <span class="token operator">=&gt;</span> #popCallStack
          <span class="token operator">~&gt;</span> #if EXECMODE <span class="token operator">==</span>K VMTESTS #then #popWorldState #else #dropWorldState #fi
          <span class="token operator">~&gt;</span> #dropSubstate
          <span class="token operator">~&gt;</span> #registerDelta<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #registerDeltas<span class="token punctuation">(</span>REGS<span class="token punctuation">,</span> OUT<span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> #load REG <span class="token number">0</span> <span class="token operator">~&gt;</span> #refund GAVAIL <span class="token operator">~&gt;</span> #if EXECMODE <span class="token operator">==</span>K VMTESTS #then <span class="token punctuation">.</span>K #else #loads REGS OUT #fi
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> OUT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#refund&quot;</span> Operand <span class="token punctuation">[</span><span class="token class-name">strict</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #refund G<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token operator">=&gt;</span> GAVAIL <span class="token operator">+</span><span class="token keyword">Int</span> G <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>For each <code>call*</code> operation, we make a corresponding call to <code>#call</code> and a state-change to setup the custom parts of the calling environment.</p>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token punctuation">,</span> REGS <span class="token operator">=</span> call LABEL at ACCTTO <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> send VALUE <span class="token punctuation">,</span> gaslimit GCAP
          <span class="token operator">=&gt;</span> #checkCall ACCTFROM VALUE GCAP
          <span class="token operator">~&gt;</span> #call ACCTFROM ACCTTO LABEL Ccallgas<span class="token punctuation">(</span>SCHED<span class="token punctuation">,</span> #accountEmpty<span class="token punctuation">(</span>ACCTTO<span class="token punctuation">)</span><span class="token punctuation">,</span> GCAP <span class="token operator">*</span><span class="token keyword">Int</span> Sgasdivisor &lt; SCHED &gt;<span class="token punctuation">,</span> GAVAIL<span class="token punctuation">,</span> VALUE<span class="token punctuation">,</span> #sizeLVals<span class="token punctuation">(</span>REGS<span class="token punctuation">)</span><span class="token punctuation">,</span> Ccallarg<span class="token punctuation">(</span>SCHED<span class="token punctuation">,</span> ARGS<span class="token punctuation">)</span><span class="token punctuation">)</span> VALUE ARGS <span class="token boolean">false</span>
          <span class="token operator">~&gt;</span> #return REGS REG
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>previousGas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>previousGas</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec REG <span class="token punctuation">,</span> REGS <span class="token operator">=</span> staticcall LABEL at ACCTTO <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> gaslimit GCAP
          <span class="token operator">=&gt;</span> #checkCall ACCTFROM <span class="token number">0</span> GCAP
          <span class="token operator">~&gt;</span> #call ACCTFROM ACCTTO LABEL Ccallgas<span class="token punctuation">(</span>SCHED<span class="token punctuation">,</span> #accountEmpty<span class="token punctuation">(</span>ACCTTO<span class="token punctuation">)</span><span class="token punctuation">,</span> GCAP <span class="token operator">*</span><span class="token keyword">Int</span> Sgasdivisor &lt; SCHED &gt;<span class="token punctuation">,</span> GAVAIL<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> #sizeLVals<span class="token punctuation">(</span>REGS<span class="token punctuation">)</span><span class="token punctuation">,</span> Ccallarg<span class="token punctuation">(</span>SCHED<span class="token punctuation">,</span> ARGS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">0</span> ARGS <span class="token boolean">true</span>
          <span class="token operator">~&gt;</span> #return REGS REG
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>previousGas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>previousGas</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="account-creation%2Fdeletion">Account Creation/Deletion</h3>
<ul>
<li><code>#create____</code> transfers the endowment to the new account and triggers the execution of the initialization code.</li>
<li><code>#codeDeposit_</code> checks the result of initialization code and whether the code deposit can be paid, indicating an error if not.</li>
<li><code>#checkCreate</code> checks that the account has sufficient balance for the balance transfer, that the call depth limit is not reached, and increments the nonce of the creator account.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#create&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> Contract Ints
                        <span class="token operator">|</span> <span class="token string">&quot;#mkCreate&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> Contract <span class="token keyword">Int</span> <span class="token keyword">Int</span> Ints
                        <span class="token operator">|</span> <span class="token string">&quot;#checkCreate&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span>
                        <span class="token operator">|</span> <span class="token string">&quot;#checkContract&quot;</span> Contract
                        <span class="token operator">|</span> <span class="token string">&quot;#finishTypeChecking&quot;</span>
    <span class="token keyword">syntax</span> Contract <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#illFormed&quot;</span>
 <span class="token comment">// --------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkCreate ACCT VALUE <span class="token operator">~&gt;</span> #create _ _ GAVAIL _ _ _ <span class="token operator">=&gt;</span> #refund GAVAIL <span class="token operator">~&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate <span class="token operator">~&gt;</span> #exception <span class="token punctuation">(</span>#if VALUE &gt;<span class="token keyword">Int</span> BAL #then OUT_OF_FUNDS #else CALL_STACK_OVERFLOW #fi<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> VALUE &gt;<span class="token keyword">Int</span> BAL orBool CD <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">1024</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkCreate ACCT VALUE <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BAL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> NONCE <span class="token operator">=&gt;</span> #if EXECMODE <span class="token operator">==</span>K VMTESTS #then NONCE #else NONCE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>VALUE &gt;<span class="token keyword">Int</span> BAL orBool VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">0</span> <span class="token attr-name">orBool</span> <span class="token attr-name">CD</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #checkContract CONTRACT <span class="token operator">=&gt;</span> CONTRACT <span class="token operator">~&gt;</span> #finishTypeChecking <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token punctuation">(</span>_<span class="token punctuation">:</span>WellFormednessCell <span class="token operator">=&gt;</span> 
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>well-formedness</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>well-formedness-schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>well-formedness-schedule</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>well-formedness</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #finishTypeChecking <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span> <span class="token operator">=&gt;</span> #illFormed <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>
         <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #illFormed <span class="token operator">~&gt;</span> <span class="token punctuation">(</span>K<span class="token punctuation">:</span>KItem <span class="token operator">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> K <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K #finishTypeChecking

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #illFormed <span class="token operator">~&gt;</span> #finishTypeChecking <span class="token operator">~&gt;</span> #create _ _ GAVAIL _ _ _ <span class="token operator">=&gt;</span> #refund GAVAIL <span class="token operator">~&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate <span class="token operator">~&gt;</span> #exception CONTRACT_INVALID <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeChecking</span><span class="token punctuation">&gt;</span></span> <span class="token boolean">true</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeChecking</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> #create ACCTFROM ACCTTO GAVAIL VALUE CODE ARGS
      <span class="token operator">=&gt;</span> #pushCallStack <span class="token operator">~&gt;</span> #pushWorldState <span class="token operator">~&gt;</span> #pushSubstate
      <span class="token operator">~&gt;</span> #initAccount ACCTTO
      <span class="token operator">~&gt;</span> #transferFunds ACCTFROM ACCTTO VALUE
      <span class="token operator">~&gt;</span> #mkCreate ACCTFROM ACCTTO CODE GAVAIL VALUE ARGS

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #mkCreate ACCTFROM ACCTTO CODE GAVAIL VALUE ARGS
          <span class="token operator">=&gt;</span> #initVM<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #initFun<span class="token punctuation">(</span>init<span class="token punctuation">,</span> #sizeRegs<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token operator">=&gt;</span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> OLDGAVAIL <span class="token operator">=&gt;</span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
         <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> _ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=&gt;</span> #loadCode<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caller</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCTFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caller</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callDepth</span><span class="token punctuation">&gt;</span></span> CD <span class="token operator">=&gt;</span> CD <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callDepth</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callValue</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> VALUE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callValue</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTTO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> NONCE <span class="token operator">=&gt;</span> NONCE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> Contract <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #subcontract <span class="token punctuation">(</span> Contract <span class="token punctuation">,</span> IeleName <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #subcontract <span class="token punctuation">(</span> <span class="token punctuation">(</span>contract NAME <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> #as CONTRACT<span class="token punctuation">)</span> _<span class="token punctuation">,</span> NAME <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> CONTRACT <span class="token punctuation">.</span>Contract
    <span class="token keyword">rule</span> #subcontract <span class="token punctuation">(</span> CONTRACT CONTRACTS<span class="token punctuation">,</span> NAME <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> CONTRACT #subcontract<span class="token punctuation">(</span>CONTRACTS<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#codeDeposit&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> Contract LValue LValue <span class="token keyword">Bool</span>
                   <span class="token operator">|</span> <span class="token string">&quot;#mkCodeDeposit&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> Contract LValue LValue <span class="token keyword">Bool</span>
                   <span class="token operator">|</span> <span class="token string">&quot;#finishCodeDeposit&quot;</span> <span class="token keyword">Int</span> Contract LValue LValue <span class="token keyword">Bool</span>
 <span class="token comment">// ----------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exception STATUS <span class="token operator">~&gt;</span> #codeDeposit _ _ _ REG _ NEW<span class="token punctuation">:</span><span class="token keyword">Bool</span> <span class="token operator">=&gt;</span> #popCallStack <span class="token operator">~&gt;</span> #popWorldState <span class="token operator">~&gt;</span> #popSubstate <span class="token operator">~&gt;</span> #if NEW #then STATUS #else #registerDelta<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #load REG STATUS #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #revert OUT <span class="token operator">~&gt;</span> #codeDeposit _ _ _ REG _ NEW<span class="token punctuation">:</span><span class="token keyword">Bool</span> <span class="token operator">=&gt;</span> #popCallStack <span class="token operator">~&gt;</span> #popWorldState <span class="token operator">~&gt;</span> #popSubstate <span class="token operator">~&gt;</span> #if NEW #then #refund GAVAIL <span class="token operator">~&gt;</span> OUT #else #registerDelta<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> intSize<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #refund GAVAIL <span class="token operator">~&gt;</span> #load REG OUT #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #end <span class="token operator">~&gt;</span> #codeDeposit ACCT LEN CODE STATUS ACCTOUT NEW <span class="token operator">=&gt;</span> #mkCodeDeposit ACCT LEN CODE STATUS ACCTOUT NEW <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #mkCodeDeposit ACCT LEN CODE STATUS ACCTOUT NEW<span class="token punctuation">:</span><span class="token keyword">Bool</span>
          <span class="token operator">=&gt;</span> #if EXECMODE <span class="token operator">==</span>K VMTESTS orBool notBool NEW #then <span class="token punctuation">.</span> #else Gcodedeposit &lt; SCHED &gt; <span class="token operator">*</span><span class="token keyword">Int</span> LEN <span class="token operator">~&gt;</span> #deductGas #fi
          <span class="token operator">~&gt;</span> #finishCodeDeposit ACCT CODE STATUS ACCTOUT NEW
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #finishCodeDeposit ACCT CODE STATUS ACCTOUT NEW<span class="token punctuation">:</span><span class="token keyword">Bool</span>
          <span class="token operator">=&gt;</span> #popCallStack <span class="token operator">~&gt;</span> #if EXECMODE <span class="token operator">==</span>K VMTESTS #then #popWorldState #else #dropWorldState #fi <span class="token operator">~&gt;</span> #dropSubstate
          <span class="token operator">~&gt;</span> #if NEW #then #refund GAVAIL <span class="token operator">~&gt;</span> <span class="token number">0</span> #else #registerDelta<span class="token punctuation">(</span>STATUS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #registerDelta<span class="token punctuation">(</span>ACCTOUT<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #refund GAVAIL <span class="token operator">~&gt;</span> #load STATUS <span class="token number">0</span> <span class="token operator">~&gt;</span> #load ACCTOUT ACCT #fi
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mode</span><span class="token punctuation">&gt;</span></span> EXECMODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> ACCT <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exception STATUS <span class="token operator">~&gt;</span> #finishCodeDeposit _ _ REG _ NEW<span class="token punctuation">:</span><span class="token keyword">Bool</span> <span class="token operator">=&gt;</span> #popCallStack <span class="token operator">~&gt;</span> #popWorldState <span class="token operator">~&gt;</span> #popSubstate <span class="token operator">~&gt;</span> #if NEW #then STATUS #else #registerDelta<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #load REG STATUS #fi <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>create</code> will attempt to <code>#create</code> the named contract using the initialization code and cleans up the result with <code>#codeDeposit</code>.</li>
<li><code>copycreate</code> will attempt to <code>#create</code> a copy of the contract at the specified address using the initialization code and cleans up the result with <code>#codeDeposit</code></li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec STATUS <span class="token punctuation">,</span> ACCTOUT <span class="token operator">=</span> create NAME <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> send VALUE
          <span class="token operator">=&gt;</span> #checkCreate ACCT VALUE
          <span class="token operator">~&gt;</span> #create ACCT #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> #if Gstaticcalldepth &lt;&lt; SCHED &gt;&gt; #then GAVAIL #else #allBut64th<span class="token punctuation">(</span>GAVAIL<span class="token punctuation">)</span> #fi VALUE #subcontract<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> ARGS
          <span class="token operator">~&gt;</span> #codeDeposit #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> #contractSize<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> #subcontract<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> STATUS ACCTOUT <span class="token boolean">false</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token operator">=&gt;</span> #if Gstaticcalldepth &lt;&lt; SCHED &gt;&gt; #then <span class="token number">0</span> #else GAVAIL <span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">64</span> #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> NONCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contractCode</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contractCode</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec STATUS <span class="token punctuation">,</span> ACCTOUT <span class="token operator">=</span> copycreate ACCTCODE <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> send VALUE
          <span class="token operator">=&gt;</span> #checkCreate ACCT VALUE
          <span class="token operator">~&gt;</span> #create ACCT #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> #if Gstaticcalldepth &lt;&lt; SCHED &gt;&gt; #then GAVAIL #else #allBut64th<span class="token punctuation">(</span>GAVAIL<span class="token punctuation">)</span> #fi VALUE CODE ARGS
          <span class="token operator">~&gt;</span> #codeDeposit #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> #contractSize<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> #mainContract<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span><span class="token punctuation">)</span> CODE STATUS ACCTOUT <span class="token boolean">false</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token operator">=&gt;</span> #if Gstaticcalldepth &lt;&lt; SCHED &gt;&gt; #then <span class="token number">0</span> #else GAVAIL <span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">64</span> #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> NONCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTCODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> ACCT <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> ACCTCODE andBool CODE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Contract

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #lookupCode<span class="token punctuation">(</span>ACCTCODE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec _ <span class="token punctuation">,</span> _ <span class="token operator">=</span> copycreate ACCTCODE <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> send _ <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCTCODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Contract <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec STATUS <span class="token punctuation">,</span> ACCTOUT <span class="token operator">=</span> copycreate ACCT <span class="token punctuation">(</span> ARGS <span class="token punctuation">)</span> send VALUE
          <span class="token operator">=&gt;</span> #checkCreate ACCT VALUE
          <span class="token operator">~&gt;</span> #create ACCT #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> #if Gstaticcalldepth &lt;&lt; SCHED &gt;&gt; #then GAVAIL #else #allBut64th<span class="token punctuation">(</span>GAVAIL<span class="token punctuation">)</span> #fi VALUE CODE ARGS
          <span class="token operator">~&gt;</span> #codeDeposit #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> #contractSize<span class="token punctuation">(</span>CODE<span class="token punctuation">,</span> #mainContract<span class="token punctuation">(</span>CODE<span class="token punctuation">)</span><span class="token punctuation">)</span> CODE STATUS ACCTOUT <span class="token boolean">false</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gas</span><span class="token punctuation">&gt;</span></span> GAVAIL <span class="token operator">=&gt;</span> #if Gstaticcalldepth &lt;&lt; SCHED &gt;&gt; #then <span class="token number">0</span> #else GAVAIL <span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">64</span> #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gas</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> NONCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span> CODE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #loadAccount ACCT<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #exec _ <span class="token punctuation">,</span> _ <span class="token operator">=</span> copycreate ACCT <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> send _ <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> ACCTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeAccounts</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">requires</span> notBool ACCT in ACCTS
</code></pre>
<p><code>selfdestruct</code> marks the current account for deletion and transfers funds out of the current account.
Self destructing to yourself, unlike a regular transfer, destroys the balance in the account, irreparably losing it.</p>
<pre class="language-k"><code>    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec selfdestruct ACCTTO <span class="token operator">=&gt;</span> #transferFunds ACCT ACCTTO BALFROM <span class="token operator">~&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selfDestruct</span><span class="token punctuation">&gt;</span></span> SDS <span class="token punctuation">(</span><span class="token punctuation">.</span>Set <span class="token operator">=&gt;</span> SetItem<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selfDestruct</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>refund</span><span class="token punctuation">&gt;</span></span> RF <span class="token operator">=&gt;</span> #if ACCT in SDS #then RF #else RF <span class="token operator">+</span><span class="token keyword">Int</span> Rselfdestruct &lt; SCHED &gt; #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>refund</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BALFROM <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ACCT <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> ACCTTO

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec selfdestruct ACCT <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schedule</span><span class="token punctuation">&gt;</span></span> SCHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schedule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selfDestruct</span><span class="token punctuation">&gt;</span></span> SDS <span class="token punctuation">(</span><span class="token punctuation">.</span>Set <span class="token operator">=&gt;</span> SetItem<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selfDestruct</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>refund</span><span class="token punctuation">&gt;</span></span> RF <span class="token operator">=&gt;</span> #if ACCT in SDS #then RF #else RF <span class="token operator">+</span><span class="token keyword">Int</span> Rselfdestruct &lt; SCHED &gt; #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>refund</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>acctID</span><span class="token punctuation">&gt;</span></span> ACCT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>acctID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>balance</span><span class="token punctuation">&gt;</span></span> BALFROM <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>balance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
<span class="token keyword">endmodule</span>
</code></pre>
<h1 id="precompiled-contract">Precompiled Contract</h1>
<ul>
<li><code>#precompiled</code> is a placeholder for the pre-compiled contracts at addresses 1.</li>
</ul>
<pre class="language-k"><code><span class="token keyword">module</span> IELE<span class="token operator">-</span>PRECOMPILED
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>DATA
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>CONFIGURATION
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>INFRASTRUCTURE

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#precompiledAccount&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------</span>
    <span class="token keyword">rule</span> #precompiledAccount <span class="token operator">=&gt;</span> <span class="token number">1</span>

    <span class="token keyword">syntax</span> ProgramCell <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#precompiled&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------</span>
    <span class="token keyword">rule</span> #precompiled <span class="token operator">=&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>functions</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>ecrec     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> ECREC     <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">4</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>sha256    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> SHA256    <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">2</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>rip160    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> RIP160    <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">2</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>id        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> ID        <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">1</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>ecadd     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> ECADD     <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">4</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>ecmul     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> ECMUL     <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">3</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> iele<span class="token punctuation">.</span>ecpairing <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> ECPAIRING <span class="token punctuation">.</span>Instructions <span class="token punctuation">.</span>LabeledBlocks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token number">3</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>functions</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecrec<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>rip160<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecadd<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecmul<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecpairing<span class="token punctuation">)</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecrec<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>rip160<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecadd<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecmul<span class="token punctuation">)</span>
             SetItem<span class="token punctuation">(</span>iele<span class="token punctuation">.</span>ecpairing<span class="token punctuation">)</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span>
             <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>ecrec
             <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>sha256
             <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>rip160
             <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>id
             <span class="token number">5</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>ecadd
             <span class="token number">6</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>ecmul
             <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; iele<span class="token punctuation">.</span>ecpairing
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li><code>@iele.ecrec</code> performs ECDSA public key recovery.</li>
<li><code>@iele.sha256</code> performs the SHA2-256 hash function.</li>
<li><code>@iele.rip160</code> performs the RIPEMD-160 hash function.</li>
<li><code>@iele.id</code> is the identity function (copies input to output).</li>
<li><code>@iele.ecadd</code> is the BN128 elliptic curve addition function.</li>
<li><code>@iele.ecmul</code> is the BN128 elliptic curve scalar multiplication function.</li>
<li><code>@iele.ecpairing</code> is the BN128 elliptic curve pairing check function.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> PrecompiledOp
    <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> PrecompiledOp

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ECREC&quot;</span>
 <span class="token comment">// --------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ECREC <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> HASH <span class="token punctuation">,</span> V <span class="token punctuation">,</span> R <span class="token punctuation">,</span> S <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #ecrec<span class="token punctuation">(</span>#sender<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> HASH<span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> V<span class="token punctuation">,</span> Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> R<span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> S<span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> HASH <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool V <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool R <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool S <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ECREC <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> HASH <span class="token punctuation">,</span> V <span class="token punctuation">,</span> R <span class="token punctuation">,</span> S <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>HASH <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool V <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool R <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool S <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ecrec <span class="token punctuation">(</span> Account <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------</span>
    <span class="token keyword">rule</span> #ecrec<span class="token punctuation">(</span><span class="token punctuation">.</span>Account<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints
    <span class="token keyword">rule</span> #ecrec<span class="token punctuation">(</span>N<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span>    <span class="token operator">=&gt;</span>  N <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SHA256&quot;</span>
 <span class="token comment">// ---------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec SHA256 <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> LEN <span class="token punctuation">,</span> DATA <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>Sha256<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>LEN<span class="token punctuation">,</span> DATA<span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> LEN <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool DATA <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec SHA256 <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> LEN <span class="token punctuation">,</span> DATA <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>LEN <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool DATA <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;RIP160&quot;</span>
 <span class="token comment">// ---------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec RIP160 <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> LEN <span class="token punctuation">,</span> DATA <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>RipEmd160<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>LEN<span class="token punctuation">,</span> DATA<span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> LEN <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool DATA <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec RIP160 <span class="token operator">=&gt;</span> #exception USER_ERROR <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> LEN <span class="token punctuation">,</span> DATA <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>LEN <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool DATA <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ID&quot;</span>
 <span class="token comment">// -----------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ID <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> DATA <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ECADD&quot;</span>
 <span class="token comment">// --------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ECADD <span class="token operator">=&gt;</span> #ecadd<span class="token punctuation">(</span><span class="token punctuation">(</span>X1<span class="token punctuation">,</span> Y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>X2<span class="token punctuation">,</span> Y2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> X1 <span class="token punctuation">,</span> Y1 <span class="token punctuation">,</span> X2 <span class="token punctuation">,</span> Y2 <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ecadd<span class="token punctuation">(</span>G1Point<span class="token punctuation">,</span> G1Point<span class="token punctuation">)</span>
 <span class="token comment">// ----------------------------------------------</span>
    <span class="token keyword">rule</span> #ecadd<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> P2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception USER_ERROR
      <span class="token keyword">requires</span> notBool isValidPoint<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> orBool notBool isValidPoint<span class="token punctuation">(</span>P2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #ecadd<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> P2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #point<span class="token punctuation">(</span>BN128Add<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> P2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> isValidPoint<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> andBool isValidPoint<span class="token punctuation">(</span>P2<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ECMUL&quot;</span>
 <span class="token comment">// --------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ECMUL <span class="token operator">=&gt;</span> #ecmul<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">,</span> S<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> X <span class="token punctuation">,</span> Y <span class="token punctuation">,</span> S <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ecmul<span class="token punctuation">(</span>G1Point<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>
 <span class="token comment">// ------------------------------------------</span>
    <span class="token keyword">rule</span> #ecmul<span class="token punctuation">(</span>P<span class="token punctuation">,</span> S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception USER_ERROR
      <span class="token keyword">requires</span> notBool isValidPoint<span class="token punctuation">(</span>P<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #ecmul<span class="token punctuation">(</span>P<span class="token punctuation">,</span> S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> #point<span class="token punctuation">(</span>BN128Mul<span class="token punctuation">(</span>P<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> isValidPoint<span class="token punctuation">(</span>P<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Ints <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #point<span class="token punctuation">(</span>G1Point<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------</span>
    <span class="token keyword">rule</span> #point<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X <span class="token punctuation">,</span> Y <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints

    <span class="token keyword">syntax</span> PrecompiledOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ECPAIRING&quot;</span>
 <span class="token comment">// ------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #exec ECPAIRING <span class="token operator">=&gt;</span> #ecpairing<span class="token punctuation">(</span><span class="token punctuation">.</span>List<span class="token punctuation">,</span> <span class="token punctuation">.</span>List<span class="token punctuation">,</span> Int2Bytes<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>LEN<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token number">64</span><span class="token punctuation">,</span> G1<span class="token punctuation">,</span> LE<span class="token punctuation">)</span><span class="token punctuation">,</span> Int2Bytes<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>LEN<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token number">128</span><span class="token punctuation">,</span> G2<span class="token punctuation">,</span> LE<span class="token punctuation">)</span><span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>callData</span><span class="token punctuation">&gt;</span></span> LEN<span class="token punctuation">,</span> G1<span class="token punctuation">,</span> G2<span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>callData</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ecpairing<span class="token punctuation">(</span>List<span class="token punctuation">,</span> List<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>
 <span class="token comment">// -----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>K <span class="token operator">=&gt;</span> #checkPoint<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #ecpairing<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token punctuation">(</span>Bytes2Int<span class="token punctuation">(</span>G1 <span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">32</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">,</span> Bytes2Int<span class="token punctuation">(</span>G1 <span class="token punctuation">[</span> <span class="token number">32</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">32</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">:</span>G1Point<span class="token punctuation">)</span><span class="token punctuation">)</span> _<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span><span class="token punctuation">(</span>Bytes2Int<span class="token punctuation">(</span>G2 <span class="token punctuation">[</span> <span class="token number">32</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">32</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span> x Bytes2Int<span class="token punctuation">(</span>G2 <span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">32</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span> <span class="token punctuation">,</span> Bytes2Int<span class="token punctuation">(</span>G2 <span class="token punctuation">[</span> <span class="token number">96</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">32</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span> x Bytes2Int<span class="token punctuation">(</span>G2 <span class="token punctuation">[</span> <span class="token number">64</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">32</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> _<span class="token punctuation">,</span> G1 <span class="token operator">=&gt;</span> G1 <span class="token punctuation">[</span> <span class="token number">64</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> lengthBytes<span class="token punctuation">(</span>G1<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> G2 <span class="token operator">=&gt;</span> G2 <span class="token punctuation">[</span> <span class="token number">128</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> lengthBytes<span class="token punctuation">(</span>G2<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> LEN <span class="token operator">=&gt;</span> LEN <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token keyword">requires</span> LEN &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> #ecpairing<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #end <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span>BN128AtePairing<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> InternalOp <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#checkPoint&quot;</span>
 <span class="token comment">// -----------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span>#checkPoint <span class="token operator">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> #ecpairing<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>AK<span class="token punctuation">:</span><span class="token punctuation">:</span>G1Point<span class="token punctuation">)</span> _<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>BK<span class="token punctuation">:</span><span class="token punctuation">:</span>G2Point<span class="token punctuation">)</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span>
      <span class="token keyword">requires</span> isValidPoint<span class="token punctuation">(</span>AK<span class="token punctuation">)</span> andBool isValidPoint<span class="token punctuation">(</span>BK<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #checkPoint <span class="token operator">~&gt;</span> #ecpairing<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>AK<span class="token punctuation">:</span><span class="token punctuation">:</span>G1Point<span class="token punctuation">)</span> _<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>BK<span class="token punctuation">:</span><span class="token punctuation">:</span>G2Point<span class="token punctuation">)</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #exception USER_ERROR
      <span class="token keyword">requires</span> notBool isValidPoint<span class="token punctuation">(</span>AK<span class="token punctuation">)</span> orBool notBool isValidPoint<span class="token punctuation">(</span>BK<span class="token punctuation">)</span>
<span class="token keyword">endmodule</span>
</code></pre>
<h1 id="iele-program-representations">IELE Program Representations</h1>
<p>The following code processes a <code>Contract</code> and loads it into the <code>&lt;program&gt;</code> cell.</p>
<pre class="language-k"><code><span class="token keyword">module</span> IELE<span class="token operator">-</span>PROGRAM<span class="token operator">-</span>LOADING
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>COMMON
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>CONFIGURATION

    <span class="token comment">// when type checking contracts</span>
    <span class="token keyword">rule</span> contract NAME <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> DEFS <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> contract NAME <span class="token punctuation">{</span> DEFS <span class="token punctuation">}</span>

    <span class="token keyword">syntax</span> FunctionParameters <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token comment">/* when desugared to just the number of parameters */</span>

    <span class="token keyword">syntax</span> ProgramCell <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #loadCode <span class="token punctuation">(</span> Contract <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                         <span class="token operator">|</span> #loadCode <span class="token punctuation">(</span> Contract <span class="token punctuation">,</span> Contract <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>#loadCodeAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #loadCode<span class="token punctuation">(</span>contract _ <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> CONTRACTS<span class="token punctuation">,</span> CONTRACT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #loadCode<span class="token punctuation">(</span>CONTRACTS<span class="token punctuation">,</span> CONTRACT<span class="token punctuation">)</span>
      <span class="token keyword">requires</span> CONTRACTS <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Contract
    <span class="token keyword">rule</span> #loadCode<span class="token punctuation">(</span>contract _ <span class="token operator">!</span> SIZE _ <span class="token punctuation">{</span> DEFS <span class="token punctuation">}</span><span class="token punctuation">,</span> CONTRACT<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #loadDeclarations<span class="token punctuation">(</span>DEFS<span class="token punctuation">,</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>functions</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Bag <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>functions</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Map <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>programSize</span><span class="token punctuation">&gt;</span></span> SIZE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>programSize</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contractCode</span><span class="token punctuation">&gt;</span></span> CONTRACT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contractCode</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
     <span class="token keyword">rule</span> #loadCode<span class="token punctuation">(</span>CONTRACT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #loadCode<span class="token punctuation">(</span>CONTRACT<span class="token punctuation">,</span> CONTRACT<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> ProgramCell <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #loadDeclarations <span class="token punctuation">(</span> TopLevelDefinitions <span class="token punctuation">,</span> ProgramCell <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                         <span class="token operator">|</span> #loadFunction  <span class="token punctuation">(</span> TopLevelDefinitions <span class="token punctuation">,</span> Blocks <span class="token punctuation">,</span> ProgramCell <span class="token punctuation">,</span> IeleName <span class="token punctuation">,</span> FunctionCell <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #loadDeclarations<span class="token punctuation">(</span>define @ NAME <span class="token punctuation">(</span> NARGS<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> BLOCKS <span class="token punctuation">}</span> FUNCS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #loadFunction<span class="token punctuation">(</span>FUNCS<span class="token punctuation">,</span> BLOCKS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> NAME <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> NARGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #loadDeclarations<span class="token punctuation">(</span>define public @ NAME <span class="token punctuation">(</span> NARGS<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> BLOCKS <span class="token punctuation">}</span> FUNCS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span> EXPORTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #loadFunction<span class="token punctuation">(</span>FUNCS<span class="token punctuation">,</span> BLOCKS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exported</span><span class="token punctuation">&gt;</span></span> SetItem<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span> EXPORTS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exported</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcId</span><span class="token punctuation">&gt;</span></span> NAME <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nparams</span><span class="token punctuation">&gt;</span></span> NARGS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nparams</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #loadDeclarations<span class="token punctuation">(</span>external contract _ FUNCS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #loadDeclarations<span class="token punctuation">(</span>FUNCS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #loadDeclarations<span class="token punctuation">(</span><span class="token punctuation">.</span>TopLevelDefinitions<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> #loadFunction<span class="token punctuation">(</span>FUNCS<span class="token punctuation">,</span> BLOCKS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>functions</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>functions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span> NAMES <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> LBLS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> _ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jumpTable</span><span class="token punctuation">&gt;</span></span> _ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jumpTable</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nregs</span><span class="token punctuation">&gt;</span></span> _ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nregs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #loadDeclarations<span class="token punctuation">(</span>FUNCS<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>program</span><span class="token punctuation">&gt;</span></span> PROG <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcIds</span><span class="token punctuation">&gt;</span></span> NAMES SetItem<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcIds</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>funcLabels</span><span class="token punctuation">&gt;</span></span> LBLS #if NAME <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K init #then IDX <span class="token operator">|</span><span class="token operator">-</span>&gt; NAME #else <span class="token punctuation">.</span>Map #fi <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>funcLabels</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>functions</span><span class="token punctuation">&gt;</span></span> REST <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span><span class="token punctuation">&gt;</span></span> FUNC <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>instructions</span><span class="token punctuation">&gt;</span></span> BLOCKS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>instructions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jumpTable</span><span class="token punctuation">&gt;</span></span> #computeJumpTable<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jumpTable</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nregs</span><span class="token punctuation">&gt;</span></span> #computeNRegs<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nregs</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>functions</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>program</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> #if NAME <span class="token operator">==</span>K init #then IDX #else IDX <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> #fi<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> IeleName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #mainContract <span class="token punctuation">(</span> Contract <span class="token punctuation">)</span>                       <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #contractSize <span class="token punctuation">(</span> Contract <span class="token punctuation">,</span> IeleName <span class="token punctuation">)</span>                 <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #contractBytes <span class="token punctuation">(</span> Contract <span class="token punctuation">)</span>                        <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>contractBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>
                    <span class="token operator">|</span> #contractBytes <span class="token punctuation">(</span> Contract <span class="token punctuation">,</span> IeleName <span class="token punctuation">)</span>             <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#contractBytesAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #callAddress <span class="token punctuation">(</span> Contract <span class="token punctuation">,</span> IeleName <span class="token punctuation">,</span> IeleName <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #callAddress <span class="token punctuation">(</span> TopLevelDefinitions <span class="token punctuation">,</span> IeleName <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#callAddressAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #mainContract<span class="token punctuation">(</span>contract NAME <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> NAME
    <span class="token keyword">rule</span> #mainContract<span class="token punctuation">(</span>contract _ <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #mainContract<span class="token punctuation">(</span>REST<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #contractSize<span class="token punctuation">(</span>contract NAME <span class="token operator">!</span> SIZE _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> _<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> SIZE
    <span class="token keyword">rule</span> #contractSize<span class="token punctuation">(</span>contract _ <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #contractSize<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>contract NAME <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> FUNCS <span class="token punctuation">}</span> _<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> FUNC<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #callAddress<span class="token punctuation">(</span>FUNCS<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>contract _ <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> FUNC<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #callAddress<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> FUNC<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>define public @ NAME <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> IDX
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>define @init <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #callAddress<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>define @ NAME <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #callAddress<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token keyword">requires</span> NAME <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K init
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>define public @ NAME <span class="token punctuation">(</span> _ <span class="token punctuation">)</span> <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #callAddress<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token keyword">requires</span> NAME <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K FUNC
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token punctuation">:</span>TopLevelDefinition REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #callAddress<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> FUNC<span class="token punctuation">,</span> IDX<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #callAddress<span class="token punctuation">(</span><span class="token punctuation">.</span>TopLevelDefinitions<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    
    <span class="token keyword">rule</span> #contractBytes<span class="token punctuation">(</span>CONTRACT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #contractBytes<span class="token punctuation">(</span>CONTRACT<span class="token punctuation">,</span> #mainContract<span class="token punctuation">(</span>CONTRACT<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">requires</span> CONTRACT <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Contract
    <span class="token keyword">rule</span> #contractBytes<span class="token punctuation">(</span><span class="token punctuation">.</span>Contract<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">rule</span> #contractBytes<span class="token punctuation">(</span>contract NAME <span class="token operator">!</span> _ BYTES <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> _<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> BYTES
    <span class="token keyword">rule</span> #contractBytes<span class="token punctuation">(</span>contract _ <span class="token operator">!</span> _ _ <span class="token punctuation">{</span> _ <span class="token punctuation">}</span> REST<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #contractBytes<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> NAME<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #computeJumpTable <span class="token punctuation">(</span> Blocks <span class="token punctuation">)</span>             <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #computeJumpTable <span class="token punctuation">(</span> Blocks <span class="token punctuation">,</span> Map <span class="token punctuation">,</span> Set <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#computeJumpTableAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #computeJumpTable<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeJumpTable<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">,</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token punctuation">.</span>Set<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #computeJumpTable<span class="token punctuation">(</span><span class="token punctuation">.</span>LabeledBlocks<span class="token punctuation">,</span> JUMPS<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> JUMPS

    <span class="token keyword">rule</span> #computeJumpTable<span class="token punctuation">(</span>LABEL <span class="token punctuation">:</span> INSTRS BLOCKS<span class="token punctuation">,</span> JUMPS<span class="token punctuation">,</span> LABELS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeJumpTable<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">,</span> JUMPS <span class="token punctuation">[</span> LABEL &lt;<span class="token operator">-</span> INSTRS BLOCKS <span class="token punctuation">]</span><span class="token punctuation">,</span> LABELS SetItem<span class="token punctuation">(</span>LABEL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> notBool LABEL in LABELS
    <span class="token keyword">rule</span> #computeJumpTable<span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token punctuation">:</span>LabeledBlock BLOCKS<span class="token punctuation">,</span> JUMPS<span class="token punctuation">,</span> LABELS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeJumpTable<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">,</span> JUMPS<span class="token punctuation">,</span> LABELS<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #computeJumpTable<span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token punctuation">:</span>UnlabeledBlock BLOCKS<span class="token punctuation">,</span> JUMPS<span class="token punctuation">,</span> LABELS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeJumpTable<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">,</span> JUMPS<span class="token punctuation">,</span> LABELS<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #registers <span class="token punctuation">(</span> Instruction <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #registers <span class="token punctuation">(</span> LValues <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>registersLValues<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> #registers <span class="token punctuation">(</span> Operands <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>registersOperands<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #computeNRegs <span class="token punctuation">(</span> Blocks <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #computeNRegs <span class="token punctuation">(</span> Blocks <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#computeNRegsAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #computeNRegs<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeNRegs<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #computeNRegs<span class="token punctuation">(</span><span class="token punctuation">.</span>LabeledBlocks<span class="token punctuation">,</span> NREGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> NREGS
    <span class="token keyword">rule</span> #computeNRegs<span class="token punctuation">(</span>LABEL <span class="token punctuation">:</span> INSTRS BLOCKS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeNRegs<span class="token punctuation">(</span>INSTRS BLOCKS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #computeNRegs<span class="token punctuation">(</span>INSTR INSTRS<span class="token punctuation">:</span><span class="token punctuation">:</span>Instructions BLOCKS<span class="token punctuation">:</span><span class="token punctuation">:</span>LabeledBlocks<span class="token punctuation">,</span> NREGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeNRegs<span class="token punctuation">(</span>INSTRS BLOCKS<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>INSTR<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> NREGS<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #computeNRegs<span class="token punctuation">(</span><span class="token punctuation">.</span>Instructions BLOCKS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #computeNRegs<span class="token punctuation">(</span>BLOCKS<span class="token punctuation">,</span> REGS<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> _<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> R1
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> load <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> load <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">,</span> <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>store <span class="token operator">%</span> R1<span class="token punctuation">,</span> <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>store <span class="token operator">%</span> R1<span class="token punctuation">,</span> <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">,</span> <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> sload <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>sstore <span class="token operator">%</span> R1<span class="token punctuation">,</span> <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> iszero <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> not <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> log2 <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> add <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> mul <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> sub <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> div <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> exp <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> mod <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> addmod <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">,</span> <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> mulmod <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">,</span> <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> expmod <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">,</span> <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> byte <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> sext <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> twos <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> bswap <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> and <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> or <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> xor <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> shift <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> cmp _ <span class="token operator">%</span> R2<span class="token punctuation">,</span> <span class="token operator">%</span> R3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> sha3 <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>br _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>br <span class="token operator">%</span> R1<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> R1
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>R1 <span class="token operator">=</span> call @ _ <span class="token punctuation">(</span> R2 <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span><span class="token punctuation">,</span> #registers<span class="token punctuation">(</span>R2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>R1 <span class="token operator">=</span> call @ _ at <span class="token operator">%</span> R2 <span class="token punctuation">(</span> R3 <span class="token punctuation">)</span> send <span class="token operator">%</span> R4<span class="token punctuation">,</span> gaslimit <span class="token operator">%</span> R5<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R3<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R4<span class="token punctuation">,</span> R5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>R1 <span class="token operator">=</span> staticcall @ _ at <span class="token operator">%</span> R2 <span class="token punctuation">(</span> R3 <span class="token punctuation">)</span> gaslimit <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R3<span class="token punctuation">)</span><span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>R1 <span class="token operator">=</span> call <span class="token operator">%</span> R3 <span class="token punctuation">(</span> R2 <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span><span class="token punctuation">,</span> #registers<span class="token punctuation">(</span>R2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>R1 <span class="token operator">=</span> call <span class="token operator">%</span> R6 at <span class="token operator">%</span> R2 <span class="token punctuation">(</span> R3 <span class="token punctuation">)</span> send <span class="token operator">%</span> R4<span class="token punctuation">,</span> gaslimit <span class="token operator">%</span> R5<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R3<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R4<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R5<span class="token punctuation">,</span> R6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1 <span class="token operator">=</span> calladdress _ at <span class="token operator">%</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>R1 <span class="token operator">=</span> staticcall <span class="token operator">%</span> R5 at <span class="token operator">%</span> R2 <span class="token punctuation">(</span> R3 <span class="token punctuation">)</span> gaslimit <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R3<span class="token punctuation">)</span><span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R4<span class="token punctuation">,</span> R5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>ret R1<span class="token punctuation">:</span><span class="token punctuation">:</span>NonEmptyOperands<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #registers<span class="token punctuation">(</span>R1<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>revert <span class="token operator">%</span> R1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> R1
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>log <span class="token operator">%</span> R1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> R1
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>log <span class="token operator">%</span> R1<span class="token punctuation">,</span> R2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> #registers<span class="token punctuation">(</span>R2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1<span class="token punctuation">,</span> <span class="token operator">%</span> R2 <span class="token operator">=</span> create _ <span class="token punctuation">(</span> R3 <span class="token punctuation">)</span> send <span class="token operator">%</span> R4<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R3<span class="token punctuation">)</span><span class="token punctuation">,</span> R4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> R1<span class="token punctuation">,</span> <span class="token operator">%</span> R2 <span class="token operator">=</span> copycreate <span class="token operator">%</span> R3 <span class="token punctuation">(</span> R4 <span class="token punctuation">)</span> send <span class="token operator">%</span> R5<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>R1<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>R3<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span>#registers<span class="token punctuation">(</span>R4<span class="token punctuation">)</span><span class="token punctuation">,</span> R5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span>selfdestruct <span class="token operator">%</span> R1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> R1

    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> REG<span class="token punctuation">,</span> REGS<span class="token punctuation">:</span><span class="token punctuation">:</span>LValues<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> #registers<span class="token punctuation">(</span>REGS<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token operator">%</span> REG<span class="token punctuation">,</span> REGS<span class="token punctuation">:</span><span class="token punctuation">:</span>Operands<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span>REG<span class="token punctuation">,</span> #registers<span class="token punctuation">(</span>REGS<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token punctuation">.</span>LValues<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">rule</span> #registers<span class="token punctuation">(</span><span class="token punctuation">.</span>Operands<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>
      </div>
    </div>
<footer class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-2 mb-md-0 mb-4">
        <span class="pr-md-5 pr-0 py-3">
          <a href="https://runtimeverification.com" target="_blank">
            <picture>
              <source
                srcset="../assets/img/rv-logo-dark.png"
                media="(prefers-color-scheme: dark)"
              />
              <img
                class="pr-3 footer-logo"
                src="../assets/img/rv-logo.png"
                alt="Runtime Verification Inc logo"
              />
            </picture>
          </a>
        </span>
      </div>
      <div class="col-md-6 mb-md-0 mb-4"></div>
      <div class="col-md-4 text-md-right">
        <p class="copyright">
          &copy; 2020 Runtime Verification Inc. All right reserved.
        </p>
      </div>
    </div>
  </div>
</footer>

<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-163311512-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "UA-163311512-1");
</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../assets/js/index.js"></script>
  </body>
</html>
