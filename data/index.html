<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="IELE Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../assets/img/favicon.ico" />

<title>IELE Semantics | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../index.html"> IELE Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/iele-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../">Homepage</a>
      <a class="bd-toc-link" href="../INSTALL">Install</a>
      <a class="bd-toc-link" href="../Design">Design</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="iele-words">IELE Words</h1>
<p>IELE uses arbitrary-precision integers, and sometimes also bytes (8 bit words).
Here we provide the arithmetic of these words, as well as some data-structures over them.
Both are implemented using K&apos;s <code>Int</code>.</p>
<pre class="language-k"><code><span class="token keyword">requires</span> <span class="token string">&quot;plugin/plugin/krypto.md&quot;</span>
<span class="token keyword">requires</span> <span class="token string">&quot;domains.md&quot;</span>
<span class="token keyword">requires</span> <span class="token string">&quot;json.md&quot;</span>

<span class="token keyword">module</span> IELE<span class="token operator">-</span>DATA
    <span class="token keyword">imports</span> KRYPTO
    <span class="token keyword">imports</span> STRING<span class="token operator">-</span>BUFFER
    <span class="token keyword">imports</span> ARRAY
    <span class="token keyword">imports</span> BYTES
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>CONSTANTS
    <span class="token keyword">imports</span> IELE<span class="token operator">-</span>COMMON
    <span class="token keyword">imports</span> COLLECTIONS
    <span class="token keyword">imports</span> JSON

    <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span>
</code></pre>
<p>Some important numbers that are referred to often during execution:</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;pow30&quot;</span>  <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow160&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow256&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------</span>
    <span class="token keyword">rule</span> pow30  <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token operator">^</span><span class="token keyword">Int</span> <span class="token number">30</span>
    <span class="token keyword">rule</span> pow160 <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token operator">^</span><span class="token keyword">Int</span> <span class="token number">160</span>
    <span class="token keyword">rule</span> pow256 <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token operator">^</span><span class="token keyword">Int</span> <span class="token number">256</span>
</code></pre>
<h2 id="primitives">Primitives</h2>
<p>Primitives provide the basic conversion from K&apos;s sorts <code>Int</code> and <code>Bool</code> to IELE&apos;s words.</p>
<ul>
<li><code>chop</code> interperets an integers modulo $2^256$. This is used when interpreting
arbitrary precision integers as memory indices.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> chop <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------</span>
    <span class="token keyword">rule</span> chop <span class="token punctuation">(</span> I<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bitRangeInt<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">0</span>  <span class="token attr-name">orBool</span> <span class="token attr-name">I</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> pow256
    <span class="token keyword">rule</span> chop <span class="token punctuation">(</span> I<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I               <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool I &lt;<span class="token keyword">Int</span> pow256
</code></pre>
<ul>
<li><code>bool2Word</code> interperets a <code>Bool</code> as a <code>Int</code>.</li>
<li><code>word2Bool</code> interperets a <code>Int</code> as a <code>Bool</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bool2Word <span class="token punctuation">(</span> <span class="token keyword">Bool</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------</span>
    <span class="token keyword">rule</span> bool2Word<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token number">1</span>
    <span class="token keyword">rule</span> bool2Word<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> word2Bool <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------</span>
    <span class="token keyword">rule</span> word2Bool<span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span>
    <span class="token keyword">rule</span> word2Bool<span class="token punctuation">(</span> W <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>  <span class="token keyword">requires</span> W <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>
</code></pre>
<h3 id="empty-account">Empty Account</h3>
<ul>
<li><code>.Account</code> represents the case when an account ID is needed, but
the actual value of the account ID is the empty set. This is used, for example, when
referring to the destination of a message which creates a new contract.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Account <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.Account&quot;</span> <span class="token operator">|</span> <span class="token keyword">Int</span>
</code></pre>
<h3 id="register-operations">Register Operations</h3>
<ul>
<li><code>#sizeRegs(R)</code> returns the number of registers in a list of Operands.</li>
<li><code>#sizeLVals(R)</code> returns the number of registers in a list of LValues.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sizeRegs <span class="token punctuation">(</span> Operands <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #sizeRegs <span class="token punctuation">(</span> Operands <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#sizeRegsAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #sizeRegs<span class="token punctuation">(</span>REGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sizeRegs<span class="token punctuation">(</span>REGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #sizeRegs<span class="token punctuation">(</span>REG <span class="token punctuation">,</span> REGS<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sizeRegs<span class="token punctuation">(</span>REGS<span class="token punctuation">,</span> N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #sizeRegs<span class="token punctuation">(</span><span class="token punctuation">.</span>Operands<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> N

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sizeLVals <span class="token punctuation">(</span> LValues <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #sizeLVals <span class="token punctuation">(</span> LValues <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#sizeLValuesAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #sizeLVals<span class="token punctuation">(</span>REGS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sizeLVals<span class="token punctuation">(</span>REGS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #sizeLVals<span class="token punctuation">(</span>REG <span class="token punctuation">,</span> REGS<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sizeLVals<span class="token punctuation">(</span>REGS<span class="token punctuation">,</span> N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #sizeLVals<span class="token punctuation">(</span><span class="token punctuation">.</span>LValues<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> N

    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> IeleName2String <span class="token punctuation">(</span> IeleName <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> IeleNameToken2String <span class="token punctuation">(</span> IeleNameToken <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>token2string<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> IeleNameToken <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> String2IeleName <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>string2token<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> IeleName2String<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Int2String<span class="token punctuation">(</span>I<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> IeleName2String<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> IeleNameToken2String<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> StringIeleName2String <span class="token punctuation">(</span> StringIeleName <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>token2string<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> getInt<span class="token punctuation">(</span>K<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> IeleName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> getIeleName<span class="token punctuation">(</span>K<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------</span>
    <span class="token keyword">rule</span> getInt<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I
    <span class="token keyword">rule</span> getIeleName<span class="token punctuation">(</span>X<span class="token punctuation">:</span>IeleName<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X

</code></pre>
<h2 id="arithmetic">Arithmetic</h2>
<ul>
<li><code>up/Int</code> performs integer division but rounds up instead of down.</li>
</ul>
<p>NOTE: Here, we choose to add <code>I2 -Int 1</code> to the numerator beforing doing the division to mimic the C++ implementation.
You could alternatively calculate <code>I1 %Int I2</code>, then add one to the normal integer division afterward depending on the result.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;up/Int&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>ceilDiv<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------</span>
    <span class="token keyword">rule</span> I1 up<span class="token operator">/</span><span class="token keyword">Int</span> I2 <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>I1 <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>I2 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token keyword">Int</span> I2 <span class="token keyword">requires</span> I2 &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

</code></pre>
<ul>
<li><code>intSize</code> returns the size in words of an integer.</li>
<li><code>bitsInWords</code> converts a number of bits to a number of words.</li>
<li><code>bytesInWords</code> ocnverts a number of bytes to a number of words.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> intSize <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------</span>
    <span class="token keyword">rule</span> intSize<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>log2Int<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">2</span><span class="token punctuation">)</span> up<span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">64</span> <span class="token keyword">requires</span> N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> intSize<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
    <span class="token keyword">rule</span> intSize<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> intSize<span class="token punctuation">(</span><span class="token operator">~</span><span class="token keyword">Int</span> N<span class="token punctuation">)</span> <span class="token keyword">requires</span> N &lt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> intSizes <span class="token punctuation">(</span> Ints <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------</span>
    <span class="token keyword">rule</span> intSizes<span class="token punctuation">(</span><span class="token punctuation">.</span>Ints<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> intSizes<span class="token punctuation">(</span>I <span class="token punctuation">,</span> INTS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> intSize<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> intSizes<span class="token punctuation">(</span>INTS<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> intSizes <span class="token punctuation">(</span> Array <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Schedule <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>intSizesArr<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> intSizes <span class="token punctuation">(</span> Array <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Schedule <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>intSizesAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">:</span><span class="token punctuation">:</span>Array<span class="token punctuation">,</span> I<span class="token punctuation">,</span> SCHED<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">,</span> I<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> SCHED<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">:</span><span class="token punctuation">:</span>Array<span class="token punctuation">,</span> I<span class="token punctuation">,</span> I<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">,</span> I<span class="token punctuation">,</span> J<span class="token punctuation">,</span> SCHED<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> intSize<span class="token punctuation">(</span>getInt<span class="token punctuation">(</span>ARR <span class="token punctuation">[</span> J <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">,</span> I<span class="token punctuation">,</span> J <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> SCHED<span class="token punctuation">)</span>
      <span class="token keyword">requires</span> SCHED <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K ALBE <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">,</span> I<span class="token punctuation">,</span> J<span class="token punctuation">,</span> ALBE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> getInt<span class="token punctuation">(</span>ARR <span class="token punctuation">[</span> J <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> intSizes<span class="token punctuation">(</span>ARR<span class="token punctuation">,</span> I<span class="token punctuation">,</span> J <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> ALBE<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bitsInWords <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Schedule <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------</span>
    <span class="token keyword">rule</span> bitsInWords<span class="token punctuation">(</span>I<span class="token punctuation">,</span> ALBE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I up<span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">256</span>
    <span class="token keyword">rule</span> bitsInWords<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I up<span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">64</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bytesInWords <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------</span>
    <span class="token keyword">rule</span> bytesInWords<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I up<span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">8</span>
</code></pre>
<p>Here we provide simple syntactic sugar over our power-modulus operator.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> powmod<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------</span>
    <span class="token keyword">rule</span> powmod<span class="token punctuation">(</span>W0<span class="token punctuation">,</span> W1<span class="token punctuation">,</span> W2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W0 <span class="token operator">^</span><span class="token operator">%</span><span class="token keyword">Int</span> W1 W2 <span class="token keyword">requires</span> W2 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<ul>
<li><code>gcdInt</code> computes the gcd of two integers.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> gcdInt<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>  <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #gcdInt<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------</span>
    <span class="token keyword">rule</span> gcdInt<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #gcdInt<span class="token punctuation">(</span>absInt<span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">,</span> absInt<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> absInt<span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> absInt<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> gcdInt<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #gcdInt<span class="token punctuation">(</span>absInt<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> absInt<span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #gcdInt<span class="token punctuation">(</span>A<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> A
    <span class="token keyword">rule</span> #gcdInt<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #gcdInt<span class="token punctuation">(</span>B<span class="token punctuation">,</span> A modInt B<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
</code></pre>
<h2 id="bitwise-operators">Bitwise Operators</h2>
<ul>
<li><code>byte</code> gets byte $N$ (0 being the LSB).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> byte <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------</span>
    <span class="token keyword">rule</span> byte<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bitRangeInt<span class="token punctuation">(</span>W<span class="token punctuation">,</span> N &lt;&lt;<span class="token keyword">Int</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>_&lt;&lt;Byte_</code> shifts an integer 8 bits to the left.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&lt;Byte&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------</span>
    <span class="token keyword">rule</span> N &lt;&lt;Byte M <span class="token operator">=&gt;</span> N &lt;&lt;<span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span><span class="token keyword">Int</span> M<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>signextend(N, W)</code> sign-extends from byte $N$ of $W$ (0 being LSB).</li>
<li><code>twos(N, W)</code> converts a signed integer from byte $N$ of $W$ to twos-complement representation (0 being LSB).</li>
<li><code>bswap(N, W)</code> converts a signed integer from byte $N$ of $W$ from little endian to big endian representation (or back).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> signextend <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> twos <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> bswap <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>      <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------</span>
    <span class="token keyword">rule</span> signextend<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> signExtendBitRangeInt<span class="token punctuation">(</span>W<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> N &lt;&lt;<span class="token keyword">Int</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> twos<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bitRangeInt<span class="token punctuation">(</span>W<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> N &lt;&lt;<span class="token keyword">Int</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> bswap<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Bytes2Int<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>N<span class="token punctuation">,</span> twos<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">,</span> LE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>keccak</code> serves as a wrapper around the <code>Keccak256</code> in <code>KRYPTO</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> keccak <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------</span>
    <span class="token keyword">rule</span> keccak<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>WS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="data-structures">Data Structures</h1>
<p>Several data-structures and operations over <code>Int</code> are useful to have around.</p>
<h2 id="word-stack">Word Stack</h2>
<p>IELE makes use of a stack in some places in order to represent lists of integers.
The stack and some standard operations over it are provided here.
This stack also serves as a cons-list, so we provide some standard cons-list manipulation tools.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">[</span>flatPredicate<span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.WordStack&quot;</span> <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;:&quot;</span> WordStack
 <span class="token comment">// -----------------------------------------------------</span>
</code></pre>
<ul>
<li><code>_++_</code> acts as <code>WordStack</code> append.</li>
<li><code>#rev</code> reverses a <code>WordStack</code>.</li>
<li><code>#take(N , WS)</code> keeps the first $N$ elements of a <code>WordStack</code> (passing with zeros as needed).</li>
<li><code>#drop(N , WS)</code> removes the first $N$ elements of a <code>WordStack</code>.</li>
<li><code>WS [ N .. W ]</code> access the range of <code>WS</code> beginning with <code>N</code> of width <code>W</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> WordStack <span class="token string">&quot;++&quot;</span> WordStack <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">right</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">.</span>WordStack <span class="token operator">++</span> WS<span class="token string">&apos; =&gt; WS&apos;</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS<span class="token punctuation">)</span>   <span class="token operator">++</span> WS<span class="token string">&apos; =&gt; W : (WS ++ WS&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rev <span class="token punctuation">(</span> WordStack <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rev <span class="token punctuation">(</span> <span class="token punctuation">.</span>WordStack <span class="token punctuation">,</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> WS
    <span class="token keyword">rule</span> #rev <span class="token punctuation">(</span> W <span class="token punctuation">:</span> WS1 <span class="token punctuation">,</span> WS2 <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rev<span class="token punctuation">(</span>WS1<span class="token punctuation">,</span> W <span class="token punctuation">:</span> WS2<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #take <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                       <span class="token operator">|</span> #take <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#takeAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">)</span>             <span class="token operator">=&gt;</span> #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #take<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _<span class="token punctuation">,</span> WS<span class="token punctuation">)</span>          <span class="token operator">=&gt;</span> #rev<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #take<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">:</span> WS<span class="token punctuation">)</span>  <span class="token keyword">requires</span> N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS1<span class="token punctuation">)</span><span class="token punctuation">,</span> WS2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #take<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> WS1<span class="token punctuation">,</span>        W <span class="token punctuation">:</span> WS2<span class="token punctuation">)</span> <span class="token keyword">requires</span> N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #drop <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------</span>
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> WS<span class="token punctuation">)</span>         <span class="token operator">=&gt;</span> WS
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>WordStack
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> #drop<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> WS<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> WordStack <span class="token string">&quot;[&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;..&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> WS<span class="token punctuation">:</span><span class="token punctuation">:</span>WordStack <span class="token punctuation">[</span> START <span class="token punctuation">.</span><span class="token punctuation">.</span> WIDTH <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #take<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span> #drop<span class="token punctuation">(</span>chop<span class="token punctuation">(</span>START<span class="token punctuation">)</span><span class="token punctuation">,</span> WS<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>WS [ N := WS&apos; ]</code> sets elements starting at $N$ of $WS$ to $WS&apos;$ (padding with zeros as needed).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> WordStack <span class="token string">&quot;[&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;:=&quot;</span> WordStack <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>assignWordStackRange<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> WS1<span class="token punctuation">:</span><span class="token punctuation">:</span>WordStack <span class="token punctuation">[</span> N <span class="token punctuation">:</span><span class="token operator">=</span> WS2<span class="token punctuation">:</span><span class="token punctuation">:</span>WordStack <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS1<span class="token punctuation">)</span> <span class="token operator">++</span> WS2 <span class="token operator">++</span> #drop<span class="token punctuation">(</span>N <span class="token operator">+</span><span class="token keyword">Int</span> #sizeWordStack<span class="token punctuation">(</span>WS2<span class="token punctuation">)</span><span class="token punctuation">,</span> WS1<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#sizeWordStack</code> calculates the size of a <code>WordStack</code>.</li>
<li><code>_in_</code> determines if a <code>Int</code> occurs in a <code>WordStack</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sizeWordStack <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>sizeWordStack<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> #sizeWordStack <span class="token punctuation">(</span> WordStack <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>sizeWordStackAux<span class="token punctuation">)</span><span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>sizeWordStackAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #sizeWordStack <span class="token punctuation">(</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #sizeWordStack <span class="token punctuation">(</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> SIZE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> SIZE
    <span class="token keyword">rule</span> #sizeWordStack <span class="token punctuation">(</span> W <span class="token punctuation">:</span> WS<span class="token punctuation">,</span> SIZE <span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> SIZE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#padToWidth(N, WS)</code> makes sure that a <code>WordStack</code> is the correct size.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #padToWidth <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #padToWidth<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> WS                     <span class="token keyword">requires</span> notBool #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> N
    <span class="token keyword">rule</span> #padToWidth<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #padToWidth<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">:</span> WS<span class="token punctuation">)</span> <span class="token keyword">requires</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> N
</code></pre>
<h2 id="memory">Memory</h2>
<ul>
<li><code>.Array</code> is an arbitrary length array of zeroes.</li>
<li><code>.Memory</code> is an arbitrary length array of byte buffers.</li>
</ul>
<pre class="language-k"><code>
    <span class="token keyword">syntax</span> Array <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.Array&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">.</span>Array <span class="token operator">=&gt;</span> makeArray<span class="token punctuation">(</span>pow30<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="byte-arrays">Byte Arrays</h2>
<p>The local memory of execution is a byte-array (instead of a word-array).</p>
<ul>
<li><code>#asUnsigned</code> will interpret a WordStack as a single unsigned integer (with MSB first).</li>
<li><code>#asAccount</code> will interpret a Bytes as a single account id (with MSB first).
Differs from <code>Bytes2Int</code> only in that an empty stack represents the empty account, not account zero.</li>
<li><code>B [ N .. W ]</code> access the range of <code>B</code> beginning with <code>N</code> of width <code>W</code> (padding with zeros as needed).</li>
<li><code>B [ N := B&apos; ]</code> sets elements starting at $N$ of $B$ to $B&apos;$ (padding with zeros as needed).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #asUnsigned <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------</span>
    <span class="token keyword">rule</span> #asUnsigned<span class="token punctuation">(</span> <span class="token punctuation">.</span>WordStack <span class="token punctuation">)</span>    <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #asUnsigned<span class="token punctuation">(</span> W <span class="token punctuation">:</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W
    <span class="token keyword">rule</span> #asUnsigned<span class="token punctuation">(</span> W0 <span class="token punctuation">:</span> W1 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #asUnsigned<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>W0 &lt;&lt;<span class="token keyword">Int</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span> <span class="token punctuation">:</span> WS<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Account <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #asAccount <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------</span>
    <span class="token keyword">rule</span> #asAccount<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account
    <span class="token keyword">rule</span> #asAccount<span class="token punctuation">(</span><span class="token string">&quot;0x&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account
    <span class="token keyword">rule</span> #asAccount<span class="token punctuation">(</span>S<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Bytes <span class="token string">&quot;[&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;..&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>bytesRange<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> B<span class="token punctuation">:</span><span class="token punctuation">:</span>Bytes <span class="token punctuation">[</span> I <span class="token punctuation">.</span><span class="token punctuation">.</span> J <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> padRightBytes<span class="token punctuation">(</span>substrBytes<span class="token punctuation">(</span>B<span class="token punctuation">,</span> I<span class="token punctuation">,</span> minInt<span class="token punctuation">(</span>lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> I <span class="token operator">+</span><span class="token keyword">Int</span> J<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> J<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">requires</span> I &lt;<span class="token keyword">Int</span> lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> B<span class="token punctuation">:</span><span class="token punctuation">:</span>Bytes <span class="token punctuation">[</span> I <span class="token punctuation">.</span><span class="token punctuation">.</span> J <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> padRightBytes<span class="token punctuation">(</span><span class="token punctuation">.</span>Bytes<span class="token punctuation">,</span> J<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Bytes <span class="token string">&quot;[&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;:=&quot;</span> Bytes <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>assignBytesRange<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> B<span class="token punctuation">:</span><span class="token punctuation">:</span>Bytes <span class="token punctuation">[</span> I <span class="token punctuation">:</span><span class="token operator">=</span> B<span class="token string">&apos;::Bytes ] =&gt; replaceAtBytes(padRightBytes(B, I +Int lengthBytes(B&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> I<span class="token punctuation">,</span> B&apos;<span class="token punctuation">)</span>
      <span class="token keyword">requires</span> B&apos; <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>Bytes
    <span class="token keyword">rule</span> B<span class="token punctuation">:</span><span class="token punctuation">:</span>Bytes <span class="token punctuation">[</span> I <span class="token punctuation">:</span><span class="token operator">=</span> B&apos;<span class="token punctuation">:</span><span class="token punctuation">:</span>Bytes <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> B
      <span class="token keyword">requires</span> B&apos; <span class="token operator">==</span>K <span class="token punctuation">.</span>Bytes
</code></pre>
<h2 id="addresses">Addresses</h2>
<ul>
<li><code>#addr</code> turns a IELE arbitrary-precision word into the corresponding IELE address (modulo 2^160).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #addr <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------</span>
    <span class="token keyword">rule</span> #addr<span class="token punctuation">(</span>W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W modInt pow160
</code></pre>
<ul>
<li><code>#newAddr</code> computes the address of a new account given the address and nonce of the creating account.</li>
<li><code>#sender</code> computes the sender of the transaction from its data and signature.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #newAddr <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------</span>
    <span class="token keyword">rule</span> #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>#rlpEncodeLength<span class="token punctuation">(</span>#rlpEncodeBytes<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">String</span> #rlpEncodeWord<span class="token punctuation">(</span>NONCE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Account <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sender <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>                                         <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#senderAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
                     <span class="token operator">|</span> #sender <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>                                                                 <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#senderAux2<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #sender<span class="token punctuation">(</span>HT<span class="token punctuation">,</span> TW<span class="token punctuation">,</span> TR<span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sender<span class="token punctuation">(</span>ECDSARecover<span class="token punctuation">(</span>HT<span class="token punctuation">,</span> TW<span class="token punctuation">,</span> TR<span class="token punctuation">,</span> TS<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #sender<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account
    <span class="token keyword">rule</span> #sender<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>STR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> STR <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">String</span> <span class="token string">&quot;&quot;</span>
</code></pre>
<h2 id="word-map">Word Map</h2>
<ul>
<li><code>#removeZeros</code> removes any entries in a map with zero values.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #removeZeros <span class="token punctuation">(</span> Map <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #removeZeros <span class="token punctuation">(</span> List <span class="token punctuation">,</span> Map <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#removeZerosAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #removeZeros<span class="token punctuation">(</span> M <span class="token punctuation">)</span>                                   <span class="token operator">=&gt;</span> #removeZeros<span class="token punctuation">(</span>Set2List<span class="token punctuation">(</span>keys<span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> M<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #removeZeros<span class="token punctuation">(</span> <span class="token punctuation">.</span>List<span class="token punctuation">,</span> <span class="token punctuation">.</span>Map <span class="token punctuation">)</span>                         <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Map
    <span class="token keyword">rule</span> #removeZeros<span class="token punctuation">(</span> ListItem<span class="token punctuation">(</span>KEY<span class="token punctuation">)</span> L<span class="token punctuation">,</span> KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; <span class="token number">0</span> REST <span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #removeZeros<span class="token punctuation">(</span>L<span class="token punctuation">,</span> REST<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #removeZeros<span class="token punctuation">(</span> ListItem<span class="token punctuation">(</span>KEY<span class="token punctuation">)</span> L<span class="token punctuation">,</span> KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; VALUE REST <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; VALUE #removeZeros<span class="token punctuation">(</span>L<span class="token punctuation">,</span> REST<span class="token punctuation">)</span> <span class="token keyword">requires</span> VALUE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>
</code></pre>
<h1 id="parsing%2Funparsing">Parsing/Unparsing</h1>
<p>The IELE test-sets are represented in JSON format with hex-encoding of the data and programs.
Here we provide some standard parser/unparser functions for that format.</p>
<h2 id="parsing">Parsing</h2>
<p>These parsers can interperet hex-encoded strings as <code>Int</code>s, <code>WordStack</code>s, and <code>Map</code>s.</p>
<ul>
<li><code>#parseHexWord</code> interperets a string as a single hex-encoded <code>Word</code>.</li>
<li><code>#parseByteStack</code> interperets a string as a hex-encoded stack of bytes, but makes sure to remove the leading &quot;0x&quot;.</li>
<li><code>#parseByteStackRaw</code> inteprets a string as a stack of bytes.</li>
<li><code>#parseMap</code> interperets a JSON key/value object as a map from <code>Word</code> to <code>Word</code>.</li>
<li><code>#parseAddr</code> interperets a string as a 160 bit hex-endcoded address.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseHexWord <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #parseWord    <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseHexWord<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseHexWord<span class="token punctuation">(</span><span class="token string">&quot;0x&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    <span class="token operator">=&gt;</span> String2Base<span class="token punctuation">(</span>replaceAll<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token string">&quot;0x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> <span class="token punctuation">(</span>S <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">String</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> andBool <span class="token punctuation">(</span>S <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">String</span> <span class="token string">&quot;0x&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #parseWord<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">2</span> andBool substrString<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">String</span> <span class="token string">&quot;0x&quot;</span>
    <span class="token keyword">rule</span> #parseWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> String2Int<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseByteStack <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>    <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                       <span class="token operator">|</span> #parseByteStack <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#parseByteStackAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
                       <span class="token operator">|</span> #parseByteStackRaw <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                       <span class="token operator">|</span> #parseByteStackRaw <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#parseByteStackRawAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseByteStack<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #fun<span class="token punctuation">(</span>STR <span class="token operator">=&gt;</span> #parseByteStack<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>replaceAll<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token string">&quot;0x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseByteStack<span class="token punctuation">(</span>_<span class="token punctuation">,</span> WS<span class="token punctuation">,</span> LEN<span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rev<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseByteStack<span class="token punctuation">(</span>S<span class="token punctuation">,</span> WS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> LEN<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #parseByteStack<span class="token punctuation">(</span>S<span class="token punctuation">,</span> #parseHexWord<span class="token punctuation">(</span>substrString<span class="token punctuation">(</span>S<span class="token punctuation">,</span> I<span class="token punctuation">,</span> I <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> WS<span class="token punctuation">,</span> I <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">2</span><span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #parseByteStackRaw<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseByteStackRaw<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseByteStackRaw<span class="token punctuation">(</span>S<span class="token punctuation">,</span> WS<span class="token punctuation">,</span> LEN<span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rev<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseByteStackRaw<span class="token punctuation">(</span>S<span class="token punctuation">,</span> WS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseByteStackRaw<span class="token punctuation">(</span>S<span class="token punctuation">,</span> ordChar<span class="token punctuation">(</span>substrString<span class="token punctuation">(</span>S<span class="token punctuation">,</span> I<span class="token punctuation">,</span> I <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> WS<span class="token punctuation">,</span> I <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseMap <span class="token punctuation">(</span> JSON <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------</span>
    <span class="token keyword">rule</span> #parseMap<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>JSONs                   <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Map
    <span class="token keyword">rule</span> #parseMap<span class="token punctuation">(</span> <span class="token punctuation">{</span> _   <span class="token punctuation">:</span> <span class="token punctuation">(</span>VALUE<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> REST <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseMap<span class="token punctuation">(</span><span class="token punctuation">{</span> REST <span class="token punctuation">}</span><span class="token punctuation">)</span>                                                <span class="token keyword">requires</span> #parseHexWord<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseMap<span class="token punctuation">(</span> <span class="token punctuation">{</span> KEY <span class="token punctuation">:</span> <span class="token punctuation">(</span>VALUE<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> REST <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseMap<span class="token punctuation">(</span><span class="token punctuation">{</span> REST <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> #parseHexWord<span class="token punctuation">(</span>KEY<span class="token punctuation">)</span> &lt;<span class="token operator">-</span> #parseHexWord<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token keyword">requires</span> #parseHexWord<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseAddr <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------</span>
    <span class="token keyword">rule</span> #parseAddr<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="unparsing">Unparsing</h2>
<p>We need to interperet a <code>WordStack</code> as a <code>String</code> again so that we can call <code>Keccak256</code> on it from <code>KRYPTO</code>.</p>
<ul>
<li><code>#unparseByteStack</code> turns a stack of bytes (as a <code>WordStack</code>) into a <code>String</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #unparseByteStack <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span>                <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> #unparseByteStack <span class="token punctuation">(</span> WordStack <span class="token punctuation">,</span> StringBuffer <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#unparseByteStackAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #unparseByteStack <span class="token punctuation">(</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #unparseByteStack<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token punctuation">.</span>StringBuffer<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #unparseByteStack<span class="token punctuation">(</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> BUFFER <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> StringBuffer2String<span class="token punctuation">(</span>BUFFER<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #unparseByteStack<span class="token punctuation">(</span> W <span class="token punctuation">:</span> WS<span class="token punctuation">,</span> BUFFER <span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #unparseByteStack<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> BUFFER <span class="token operator">+</span><span class="token keyword">String</span> chrChar<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="recursive-length-prefix-(rlp)">Recursive Length Prefix (RLP)</h1>
<p>RLP encoding is used extensively for executing the blocks of a transaction.
For details about RLP encoding, see the <a href="http://gavwood.com/paper.pdf" target="_blank" rel="noopener">YellowPaper Appendix B</a>.
This is included only for compatibility with the EVM test suite.</p>
<h2 id="encoding">Encoding</h2>
<ul>
<li><code>#rlpEncodeWord</code> RLP encodes a single EVM word.</li>
<li><code>#rlpEncodeBytes</code> RLP encodes a single integer as a fixed-width unsigned byte buffer.</li>
<li><code>#rlpEncodeString</code> RLP encodes a single <code>String</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeWord <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>            <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> #rlpEncodeBytes <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>     <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> #rlpEncodeString <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> #rlpEncodeInts <span class="token punctuation">(</span> Ints <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>rlpEncodeInts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>
                    <span class="token operator">|</span> #rlpEncodeInts <span class="token punctuation">(</span> StringBuffer<span class="token punctuation">,</span> Ints <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#rlpEncodeIntsAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpEncodeWord<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;\x80&quot;</span>
    <span class="token keyword">rule</span> #rlpEncodeWord<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chrChar<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token keyword">requires</span> WORD &gt;<span class="token keyword">Int</span> <span class="token number">0</span> andBool WORD &lt;<span class="token keyword">Int</span> <span class="token number">128</span>
    <span class="token keyword">rule</span> #rlpEncodeWord<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>WORD<span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> WORD <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">128</span>

    <span class="token keyword">rule</span> #rlpEncodeBytes<span class="token punctuation">(</span>WORD<span class="token punctuation">,</span> LEN<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeString<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>LEN<span class="token punctuation">,</span> WORD<span class="token punctuation">,</span> BE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> STR                        <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span> andBool ordChar<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">128</span>
    <span class="token keyword">rule</span> #rlpEncodeString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #rlpEncodeInts<span class="token punctuation">(</span>INTS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeInts<span class="token punctuation">(</span><span class="token punctuation">.</span>StringBuffer<span class="token punctuation">,</span> INTS<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncodeInts<span class="token punctuation">(</span>BUF <span class="token operator">=&gt;</span> BUF <span class="token operator">+</span><span class="token keyword">String</span> #rlpEncodeString<span class="token punctuation">(</span>Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>I<span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Signed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>I <span class="token punctuation">,</span> INTS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> INTS<span class="token punctuation">)</span> <span class="token keyword">requires</span> I <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #rlpEncodeInts<span class="token punctuation">(</span>BUF <span class="token operator">=&gt;</span> BUF <span class="token operator">+</span><span class="token keyword">String</span> #rlpEncodeString<span class="token punctuation">(</span><span class="token string">&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> INTS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> INTS<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncodeInts<span class="token punctuation">(</span>BUF<span class="token punctuation">,</span> <span class="token punctuation">.</span>Ints<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>StringBuffer2String<span class="token punctuation">(</span>BUF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeLength <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>          <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> #rlpEncodeLength <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#rlpEncodeLengthAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpEncodeLength<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> OFFSET<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chrChar<span class="token punctuation">(</span>lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> OFFSET<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">String</span> STR <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">56</span>
    <span class="token keyword">rule</span> #rlpEncodeLength<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> OFFSET<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> Bytes2String<span class="token punctuation">(</span>Int2Bytes<span class="token punctuation">(</span>lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">56</span>
    <span class="token keyword">rule</span> #rlpEncodeLength<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> BL<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chrChar<span class="token punctuation">(</span>lengthString<span class="token punctuation">(</span>BL<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> OFFSET <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">55</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">String</span> BL <span class="token operator">+</span><span class="token keyword">String</span> STR
</code></pre>
<h2 id="decoding">Decoding</h2>
<ul>
<li><code>#loadLen</code> and <code>#loadOffset</code> decode a <code>WordStack</code> into a single string in an RLP-like encoding which does not allow lists in its structure.</li>
<li><code>#rlpDecode</code> RLP decodes a single <code>String</code> into a <code>JSON</code>.</li>
<li><code>#rlpDecodeList</code> RLP decodes a single <code>String</code> into a <code>JSONs</code>, interpereting the string as the RLP encoding of a list.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> LengthPrefixType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#str&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;#list&quot;</span>
    <span class="token keyword">syntax</span> LengthPrefix <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LengthPrefixType <span class="token string">&quot;(&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #loadLen <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------</span>
    <span class="token keyword">rule</span> #loadLen <span class="token punctuation">(</span> B0 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>                               <span class="token keyword">requires</span> B0  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">128</span> <span class="token attr-name">orBool</span>  <span class="token attr-name">B0</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">192</span>
    <span class="token keyword">rule</span> #loadLen <span class="token punctuation">(</span> B0 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span>                     <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">128</span> andBool B0  &lt;<span class="token keyword">Int</span> <span class="token number">184</span>
    <span class="token keyword">rule</span> #loadLen <span class="token punctuation">(</span> B0 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #asUnsigned<span class="token punctuation">(</span>#take<span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">183</span><span class="token punctuation">,</span> WS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">184</span> andBool B0  &lt;<span class="token keyword">Int</span> <span class="token number">192</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #loadOffset <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------</span>
    <span class="token keyword">rule</span> #loadOffset <span class="token punctuation">(</span> B0 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>           <span class="token keyword">requires</span> B0  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">128</span> <span class="token attr-name">orBool</span>  <span class="token attr-name">B0</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">192</span>
    <span class="token keyword">rule</span> #loadOffset <span class="token punctuation">(</span> B0 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>           <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">128</span> andBool B0  &lt;<span class="token keyword">Int</span> <span class="token number">184</span>
    <span class="token keyword">rule</span> #loadOffset <span class="token punctuation">(</span> B0 <span class="token punctuation">:</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">182</span> <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">184</span> andBool B0  &lt;<span class="token keyword">Int</span> <span class="token number">192</span>

    <span class="token keyword">syntax</span> JSON <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpDecode<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span>               <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>rlpDecode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rlpDecode<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">,</span> LengthPrefix<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#rlpDecodeAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpDecode<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpDecode<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpDecode<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> #str<span class="token punctuation">(</span>LEN<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> substrString<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> POS <span class="token operator">+</span><span class="token keyword">Int</span> LEN<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpDecode<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> #list<span class="token punctuation">(</span>LEN<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>#rlpDecodeList<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> JSONs <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpDecodeList<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>               <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                      <span class="token operator">|</span> #rlpDecodeList<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> LengthPrefix<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#rlpDecodeListAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpDecodeList<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpDecodeList<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> POS &lt;<span class="token keyword">Int</span> lengthString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpDecodeList<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>JSONs <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #rlpDecodeList<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> _<span class="token punctuation">:</span>LengthPrefixType<span class="token punctuation">(</span>L<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpDecode<span class="token punctuation">(</span>substrString<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> L <span class="token operator">+</span><span class="token keyword">Int</span> P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> #rlpDecodeList<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> L <span class="token operator">+</span><span class="token keyword">Int</span> P<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> LengthPrefixType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#str&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;#list&quot;</span>
    <span class="token keyword">syntax</span> LengthPrefix <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LengthPrefixType <span class="token string">&quot;(&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
                          <span class="token operator">|</span> #decodeLengthPrefix <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>                                <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                          <span class="token operator">|</span> #decodeLengthPrefix <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>                          <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#decodeLengthPrefixAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
                          <span class="token operator">|</span> #decodeLengthPrefixLength <span class="token punctuation">(</span> LengthPrefixType <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                          <span class="token operator">|</span> #decodeLengthPrefixLength <span class="token punctuation">(</span> LengthPrefixType <span class="token punctuation">,</span> <span class="token keyword">Int</span>    <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#decodeLengthPrefixLengthAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> ordChar<span class="token punctuation">(</span>substrString<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #str<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> START<span class="token punctuation">)</span>                                   <span class="token keyword">requires</span> B0 &lt;<span class="token keyword">Int</span> <span class="token number">128</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #str<span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>                  <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">128</span> andBool B0 &lt;<span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">128</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">56</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#str<span class="token punctuation">,</span> STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span>  <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">128</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">56</span><span class="token punctuation">)</span> andBool B0 &lt;<span class="token keyword">Int</span> <span class="token number">192</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #list<span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">192</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>                 <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">192</span> andBool B0 &lt;<span class="token keyword">Int</span> <span class="token number">192</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">56</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#list<span class="token punctuation">,</span> STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#str<span class="token punctuation">,</span>  STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#str<span class="token punctuation">,</span>  START<span class="token punctuation">,</span> B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> Bytes2Int<span class="token punctuation">(</span>String2Bytes<span class="token punctuation">(</span>substrString<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#list<span class="token punctuation">,</span> STR<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#list<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">192</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> Bytes2Int<span class="token punctuation">(</span>String2Bytes<span class="token punctuation">(</span>substrString<span class="token punctuation">(</span>STR<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">192</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BE<span class="token punctuation">,</span> Unsigned<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>TYPE<span class="token punctuation">,</span> START<span class="token punctuation">,</span> LL<span class="token punctuation">,</span> L<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TYPE<span class="token punctuation">(</span>L<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> LL<span class="token punctuation">)</span>

<span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>
      </div>
    </div>
<footer class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-2 mb-md-0 mb-4">
        <span class="pr-md-5 pr-0 py-3">
          <a href="https://runtimeverification.com" target="_blank">
            <picture>
              <source
                srcset="../assets/img/rv-logo-dark.png"
                media="(prefers-color-scheme: dark)"
              />
              <img
                class="pr-3 footer-logo"
                src="../assets/img/rv-logo.png"
                alt="Runtime Verification Inc logo"
              />
            </picture>
          </a>
        </span>
      </div>
      <div class="col-md-6 mb-md-0 mb-4"></div>
      <div class="col-md-4 text-md-right">
        <p class="copyright">
          &copy; 2020 Runtime Verification Inc. All right reserved.
        </p>
      </div>
    </div>
  </div>
</footer>

<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-163311512-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "UA-163311512-1");
</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../assets/js/index.js"></script>
  </body>
</html>
