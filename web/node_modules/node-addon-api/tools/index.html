<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="IELE Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../assets/img/favicon.ico" />

<title>IELE Semantics | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../index.html">
    <img
      class="logo-dark"
      srcset="../../../../assets/img/k-logo.png"
      alt="K"
      style="height: 48px"
    />
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/iele-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../downloads"
    >Download</a
  >
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../INSTALL">Install</a>
      <a class="bd-toc-link" href="../../../../Design">Design</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1>Migration Script</h1>
<p>The migration tool is designed to reduce repetitive work in the migration process. However, the script is not aiming to convert every thing for you. There are usually some small fixes and major reconstruction required.</p>
<h3>How To Use</h3>
<p>To run the conversion script, first make sure you have the latest <code>node-addon-api</code> in your <code>node_modules</code> directory.</p>
<pre class="hljs"><code>npm install node-addon-api
</code></pre>
<p>Then run the script passing your project directory</p>
<pre class="hljs"><code>node ./node_modules/node-addon-api/tools/conversion.js ./
</code></pre>
<p>After finish, recompile and debug things that are missed by the script.</p>
<h3>Quick Fixes</h3>
<p>Here is the list of things that can be fixed easily.</p>
<ol>
<li>Change your methods&apos; return value to void if it doesn&apos;t return value to JavaScript.</li>
<li>Use <code>.</code> to access attribute or to invoke member function in Napi::Object instead of <code>-&gt;</code>.</li>
<li><code>Napi::New(env, value);</code> to `Napi::[Type]::New(env, value);</li>
</ol>
<h3>Major Reconstructions</h3>
<p>The implementation of <code>Napi::ObjectWrap</code> is significantly different from NAN&apos;s. <code>Napi::ObjectWrap</code> takes a pointer to the wrapped object and creates a reference to the wrapped object inside ObjectWrap constructor. <code>Napi::ObjectWrap</code> also associates wrapped object&apos;s instance methods to Javascript module instead of static methods like NAN.</p>
<p>So if you use Nan::ObjectWrap in your module, you will need to execute the following steps.</p>
<ol>
<li>Convert your [ClassName]::New function to a constructor function that takes a <code>Napi::CallbackInfo</code>. Declare it as</li>
</ol>
<pre class="hljs"><code>[ClassName](const Napi::CallbackInfo&amp; info);
</code></pre>
<p>and define it as</p>
<pre class="hljs"><code>[ClassName]::[ClassName](const Napi::CallbackInfo&amp; info) : Napi::ObjectWrap&lt;[ClassName]&gt;(info){
  ...
}
</code></pre>
<p>This way, the <code>Napi::ObjectWrap</code> constructor will be invoked after the object has been instantiated and <code>Napi::ObjectWrap</code> can use the <code>this</code> pointer to create a reference to the wrapped object.</p>
<ol start="2">
<li>Move your original constructor code into the new constructor. Delete your original constructor.</li>
<li>In your class initialization function, associate native methods in the following way. The <code>&amp;</code> character before methods is required because they are not static methods but instance methods.</li>
</ol>
<pre class="hljs"><code>Napi::FunctionReference constructor;

void [ClassName]::Init(Napi::Env env, Napi::Object exports, Napi::Object module) {
  Napi::HandleScope scope(env);
  Napi::Function ctor = DefineClass(env, &quot;Canvas&quot;, {
    InstanceMethod(&quot;Func1&quot;, &amp;[ClassName]::Func1),
    InstanceMethod(&quot;Func2&quot;, &amp;[ClassName]::Func2),
    InstanceAccessor(&quot;Value&quot;, &amp;[ClassName]::ValueGetter),
    StaticMethod(&quot;MethodName&quot;, &amp;[ClassName]::StaticMethod),
    InstanceValue(&quot;Value&quot;, Napi::[Type]::New(env, value)),
  });

  constructor = Napi::Persistent(ctor);
  constructor .SuppressDestruct();
  exports.Set(&quot;[ClassName]&quot;, ctor);
}
</code></pre>
<ol start="4">
<li>In function where you need to Unwrap the ObjectWrap in NAN like <code>[ClassName]* native = Nan::ObjectWrap::Unwrap&lt;[ClassName]&gt;(info.This());</code>, use <code>this</code> pointer directly as the unwrapped object as each ObjectWrap instance is associated with a unique object instance.</li>
</ol>
<p>If you still find issues after following this guide, please leave us an issue describing your problem and we will try to resolve it.</p>
</body></html></div>
        </main>
      </div>
    </div>
<footer class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-2 mb-md-0 mb-4">
        <span class="pr-md-5 pr-0 py-3">
          <a href="https://runtimeverification.com" target="_blank">
            <picture>
              <source
                srcset="../../../../assets/img/rv-logo-dark.png"
                media="(prefers-color-scheme: dark)"
              />
              <img
                class="pr-3 footer-logo"
                src="../../../../assets/img/rv-logo.png"
                alt="Runtime Verification Inc logo"
              />
            </picture>
          </a>
        </span>
      </div>
      <div class="col-md-6 mb-md-0 mb-4"></div>
      <div class="col-md-4 text-md-right">
        <p class="copyright">
          &copy; 2020 Runtime Verification Inc. All right reserved.
        </p>
      </div>
    </div>
  </div>
</footer>

<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-163311512-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "UA-163311512-1");
</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../assets/js/index.js"></script>
  </body>
</html>
